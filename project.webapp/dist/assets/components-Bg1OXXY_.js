import{r as f,u as mt,R as St}from"./router-cMghrlxF.js";import{T as et,Z as Ge,C as jt,a as Ke,A as Nt,L as ht,S as pt,E as Qe,X as At,B as kt,b as Oe,c as Se,d as Ct,D as tt,e as Tt,F as Et,f as It,P as st,g as Ft,I as rt,h as Dt}from"./ui-CX2R78V6.js";import{r as Lt}from"./vendor-DavUf6mE.js";var Je={exports:{}},ke={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var at;function _t(){if(at)return ke;at=1;var l=Lt(),s=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function m(k,g,c){var h,S={},F=null,E=null;c!==void 0&&(F=""+c),g.key!==void 0&&(F=""+g.key),g.ref!==void 0&&(E=g.ref);for(h in g)r.call(g,h)&&!o.hasOwnProperty(h)&&(S[h]=g[h]);if(k&&k.defaultProps)for(h in g=k.defaultProps,g)S[h]===void 0&&(S[h]=g[h]);return{$$typeof:s,type:k,key:F,ref:E,props:S,_owner:n.current}}return ke.Fragment=t,ke.jsx=m,ke.jsxs=m,ke}var nt;function Ot(){return nt||(nt=1,Je.exports=_t()),Je.exports}var e=Ot();const Pt="modulepreload",Rt=function(l){return"/"+l},ot={},it=function(s,t,r){let n=Promise.resolve();if(t&&t.length>0){let g=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),k=m?.nonce||m?.getAttribute("nonce");n=g(t.map(c=>{if(c=Rt(c),c in ot)return;ot[c]=!0;const h=c.endsWith(".css"),S=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${S}`))return;const F=document.createElement("link");if(F.rel=h?"stylesheet":Pt,h||(F.as="script"),F.crossOrigin="",F.href=c,k&&F.setAttribute("nonce",k),document.head.appendChild(F),h)return new Promise((E,P)=>{F.addEventListener("load",E),F.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(m){const k=new Event("vite:preloadError",{cancelable:!0});if(k.payload=m,window.dispatchEvent(k),!k.defaultPrevented)throw m}return n.then(m=>{for(const k of m||[])k.status==="rejected"&&o(k.reason);return s().catch(o)})},de="http://localhost:5000/api";class Mt{config={clientId:"8d042e34-5a5f-40f5-a019-ee56de49b64e",tenantId:"c16b04b5-b78c-4cce-b3f8-93686f221d09",redirectUri:"http://localhost:5173/auth/callback",scopes:["openid","profile","email","User.Read"]};constructor(){this.config.clientId||console.error("[AuthService] Azure Client ID is not configured"),this.config.tenantId||console.error("[AuthService] Azure Tenant ID is not configured"),console.log("[AuthService] Configuration loaded:",{clientId:this.config.clientId?"Configured":"Missing",tenantId:this.config.tenantId?"Configured":"Missing",redirectUri:this.config.redirectUri})}async initializeMSAL(){try{if(typeof window<"u"&&!window.msalInstance){console.log("[AuthService] Initializing MSAL with config:",{clientId:this.config.clientId,tenantId:this.config.tenantId,redirectUri:this.config.redirectUri}),console.log("[AuthService] Importing @azure/msal-browser...");const{PublicClientApplication:s}=await it(async()=>{const{PublicClientApplication:t}=await import("./index-CIVusHlu.js");return{PublicClientApplication:t}},[]);console.log("[AuthService] MSAL imported successfully"),console.log("[AuthService] Creating MSAL instance..."),window.msalInstance=new s({auth:{clientId:this.config.clientId,authority:`https://login.microsoftonline.com/${this.config.tenantId}`,redirectUri:this.config.redirectUri},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}}),console.log("[AuthService] MSAL instance created"),console.log("[AuthService] Initializing MSAL instance..."),await window.msalInstance.initialize(),console.log("[AuthService] MSAL instance initialized successfully")}else console.log("[AuthService] MSAL instance already exists");return window.msalInstance}catch(s){throw console.error("[AuthService] Error initializing MSAL:",s),new Error(`Failed to initialize Microsoft Authentication: ${s instanceof Error?s.message:"Unknown error"}`)}}async testMSALConfiguration(){try{console.log("[AuthService] Testing MSAL configuration...");const s=await this.initializeMSAL();return console.log("[AuthService] MSAL configuration test successful"),!0}catch(s){return console.error("[AuthService] MSAL configuration test failed:",s),!1}}async clearActiveInteractions(s){try{console.log("[AuthService] Clearing active interactions..."),await s.clearCache(),s.browserStorage&&await s.browserStorage.clear();const t=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);n&&n.includes("msal")&&t.push(n)}t.forEach(r=>localStorage.removeItem(r)),console.log("[AuthService] Active interactions cleared")}catch(t){console.warn("[AuthService] Warning clearing interactions:",t)}}resetMSALInstance(){try{console.log("[AuthService] Resetting MSAL instance..."),window.msalInstance&&delete window.msalInstance,console.log("[AuthService] MSAL instance reset")}catch(s){console.warn("[AuthService] Warning resetting MSAL instance:",s)}}async login(){try{if(console.log("[AuthService] Starting Microsoft login..."),console.log("[AuthService] Config:",this.config),!this.config.clientId||this.config.clientId==="your_azure_client_id_here")throw new Error("Azure Client ID not configured. Please set VITE_REACT_APP_AZURE_CLIENT_ID in your environment variables.");if(!this.config.tenantId||this.config.tenantId==="your_azure_tenant_id_here")throw new Error("Azure Tenant ID not configured. Please set VITE_REACT_APP_AZURE_TENANT_ID in your environment variables.");const s=await this.initializeMSAL();console.log("[AuthService] MSAL instance ready, starting login popup..."),await this.clearActiveInteractions(s);const t={scopes:this.config.scopes,prompt:"select_account"};console.log("[AuthService] Login request config:",t),console.log("[AuthService] About to call loginPopup...");let r;try{if(console.log("[AuthService] About to call MSAL loginPopup..."),r=await s.loginPopup(t),console.log("[AuthService] MSAL login successful, got access token"),console.log("[AuthService] MSAL response:",{hasAccessToken:!!r.accessToken,hasAccount:!!r.account,accountName:r.account?.name,accountUsername:r.account?.username}),!r.accessToken)throw console.error("[AuthService] MSAL login succeeded but no access token received"),new Error("MSAL login succeeded but no access token received");console.log("[AuthService] MSAL access token confirmed:",{tokenLength:r.accessToken.length,tokenPreview:r.accessToken.substring(0,20)+"..."}),console.log("[AuthService] MSAL login completed successfully, proceeding to backend exchange..."),console.log("[AuthService] Checking configuration before backend call:",{hasClientId:!!this.config.clientId,hasTenantId:!!this.config.tenantId,clientId:this.config.clientId,tenantId:this.config.tenantId})}catch(o){if(console.error("[AuthService] Popup error:",o),o.errorCode==="interaction_in_progress"){console.log("[AuthService] Interaction in progress, clearing cache and retrying..."),await this.clearActiveInteractions(s),await new Promise(m=>setTimeout(m,1e3));try{r=await s.loginPopup(t),console.log("[AuthService] MSAL login successful on retry, got access token")}catch(m){throw console.error("[AuthService] Retry failed:",m),m.errorCode==="interaction_in_progress"?(console.log("[AuthService] Persistent interaction issue, resetting MSAL instance..."),this.resetMSALInstance(),new Error("Authentication session is stuck. Please refresh the page and try again.")):m}}else throw o}console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] MSAL access token received:",{hasToken:!!r.accessToken,tokenLength:r.accessToken?.length,tokenPreview:r.accessToken?.substring(0,20)+"..."}),console.log("[AuthService] About to start backend token exchange process...");let n;try{console.log("[AuthService] About to call exchangeTokenForBackendToken..."),console.log("[AuthService] Backend URL will be:",`${de}/auth/login`),console.log("[AuthService] Making backend request..."),n=await this.exchangeTokenForBackendToken(r.accessToken),console.log("[AuthService] Backend token exchange successful")}catch(o){throw console.error("[AuthService] Backend token exchange failed:",o),console.error("[AuthService] Backend error details:",{message:o.message,stack:o.stack}),o}if(console.log("[AuthService] Backend response received:",{type:typeof n,keys:Object.keys(n),hasAccessToken:!!n.accessToken,hasRefreshToken:!!n.refreshToken,hasExpiresAt:!!n.expiresAt}),console.log("[AuthService] About to store tokens:",{accessToken:!!n.accessToken,refreshToken:!!n.refreshToken,expiresAt:n.expiresAt,accessTokenLength:n.accessToken?.length,refreshTokenLength:n.refreshToken?.length}),!n.accessToken||!n.refreshToken||!n.expiresAt){if(console.error("[AuthService] Missing required token fields:",{accessToken:!!n.accessToken,refreshToken:!!n.refreshToken,expiresAt:!!n.expiresAt}),!n.accessToken)throw new Error("Backend response missing access token");const o=new Date;o.setDate(o.getDate()+7);const m="fallback-refresh-"+Date.now();console.log("[AuthService] Using fallback values:",{expiresAt:o.toISOString(),refreshToken:m}),n.refreshToken=n.refreshToken||m,n.expiresAt=n.expiresAt||o.toISOString()}return this.setTokens(n.accessToken,n.refreshToken,n.expiresAt),console.log("[AuthService] Tokens stored successfully"),n}catch(s){throw console.error("[AuthService] Microsoft login error:",s),s instanceof Error?new Error(`Microsoft authentication failed: ${s.message}`):new Error("Failed to authenticate with Microsoft Entra ID")}}async googleLogin(){try{const s="1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com";return await this.loadGoogleIdentityServices(),new Promise((t,r)=>{let n=!1;const o=setTimeout(()=>{n||(n=!0,r(new Error("Google authentication timed out. Please try again.")))},1e4);try{const c=window.google.accounts.oauth2.initTokenClient({client_id:s,scope:"openid profile email",prompt:"select_account",callback:async T=>{try{if(n)return;if(clearTimeout(o),T.error){if(n=!0,T.error==="access_denied"||T.error==="user_cancelled"){console.log("🔄 [AuthService] Google OAuth cancelled by user"),r(new Error("Google sign-in was cancelled"));return}r(new Error(`Google OAuth error: ${T.error}`));return}if(!T.access_token){n=!0,r(new Error("No access token received from Google"));return}console.log("✅ [AuthService] Google OAuth successful, got access token");const U=await this.exchangeGoogleTokenForBackendToken(T.access_token);this.setTokens(U.accessToken,U.refreshToken,U.expiresAt),n=!0,t(U)}catch(U){n||(n=!0,clearTimeout(o),r(U))}}}),h=()=>{n||(n=!0,clearTimeout(o),console.log("🔄 [AuthService] Google OAuth popup closed by user"),r(new Error("Google sign-in was cancelled")))};window.addEventListener("beforeunload",h),window.addEventListener("blur",h);const S=()=>{document.hidden&&!n&&setTimeout(()=>{!n&&document.hidden&&h()},100)};document.addEventListener("visibilitychange",S),c.requestAccessToken();let F=0;const E=20,P=setInterval(()=>{if(F++,n){clearInterval(P);return}(document.hidden||!document.hasFocus())&&setTimeout(()=>{!n&&(document.hidden||!document.hasFocus())&&(clearInterval(P),h())},50),F>=E&&clearInterval(P)},100),J=()=>{clearTimeout(o),clearInterval(P),window.removeEventListener("beforeunload",h),window.removeEventListener("blur",h),document.removeEventListener("visibilitychange",S)};setTimeout(()=>{J()},5e3)}catch(c){n||(n=!0,clearTimeout(o),r(new Error(`Failed to initialize Google OAuth: ${c instanceof Error?c.message:"Unknown error"}`)))}const m=()=>{clearTimeout(o),window.removeEventListener("beforeunload",handlePopupClose)},k=t,g=r;t=c=>{m(),k(c)},r=c=>{m(),g(c)}})}catch(s){throw console.error("Google login error:",s),new Error(`Failed to authenticate with Google: ${s instanceof Error?s.message:"Unknown error"}`)}}async loadGoogleIdentityServices(){return new Promise((s,t)=>{if(window.google){s();return}const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.async=!0,r.defer=!0,r.onload=()=>s(),r.onerror=()=>t(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async googleLoginOneTap(){try{return await this.loadGoogleIdentityServices(),new Promise((s,t)=>{window.google.accounts.id.initialize({client_id:"1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com",callback:async r=>{try{if(r.error){t(new Error(r.error));return}const n=await this.exchangeGoogleTokenForBackendToken(r.credential);this.setTokens(n.accessToken,n.refreshToken,n.expiresAt),s(n)}catch(n){t(n)}}}),window.google.accounts.id.prompt()})}catch(s){throw console.error("Google One Tap login error:",s),new Error("Failed to authenticate with Google")}}async exchangeGoogleTokenForBackendToken(s){try{const r=await(await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${s}`)).json(),n=await fetch(`${de}/auth/google-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:s,userInfo:r})});if(!n.ok){const m=await n.json().catch(()=>({}));throw new Error(m.error||"Failed to authenticate with backend")}const o=await n.json();return console.log("✅ [AuthService] Google token exchange successful, received data:",{user:o.user,hasAccessToken:!!o.accessToken,hasRefreshToken:!!o.refreshToken,expiresAt:o.expiresAt}),this.setTokens(o.accessToken,o.refreshToken,o.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Google login"),o}catch(t){throw console.error("Error exchanging Google token:",t),new Error("Failed to authenticate with backend")}}async localLogin(s){try{if(console.log("🔐 [AuthService] Starting local login with credentials:",{email:s.email,passwordLength:s.password.length}),console.log("🌐 [AuthService] API Base URL:",de),!s.email||!s.password)throw new Error("Email and password are required");if(!s.email.includes("@"))throw new Error("Please enter a valid email address");if(s.password.length<6)throw new Error("Password must be at least 6 characters long");const t=await fetch(`${de}/auth/local-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("📡 [AuthService] Local login response status:",t.status),!t.ok){const n=await t.json().catch(()=>({}));throw console.error("❌ [AuthService] Local login failed:",n),t.status===401?new Error("Invalid email or password. Please check your credentials and try again."):t.status===404?new Error("User not found. Please check your email or sign up for a new account."):t.status===500?new Error("Server error. Please try again later or contact support."):new Error(n.error||`Login failed with status ${t.status}`)}const r=await t.json();if(console.log("✅ [AuthService] Local login successful, received data:",{user:r.user,hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,expiresAt:r.expiresAt}),!r.accessToken||!r.refreshToken||!r.expiresAt)throw new Error("Invalid response from server. Missing authentication tokens.");return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for local login"),r}catch(t){throw console.error("❌ [AuthService] Local login error:",t),t instanceof Error?t:new Error("Local authentication failed. Please try again.")}}async register(s){try{console.log("🔐 Registering user with credentials:",{...s,password:"[HIDDEN]"}),console.log("🌐 API Base URL:",de);const t=await fetch(`${de}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("📡 Registration response status:",t.status),!t.ok){const n=await t.json().catch(()=>({}));throw console.error("❌ Registration failed:",n),new Error(n.error||"Failed to register user")}const r=await t.json();return console.log("✅ Registration successful, received data:",{user:r.user,hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,expiresAt:r.expiresAt}),this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("💾 Tokens stored successfully"),r}catch(t){throw console.error("❌ Registration error:",t),new Error(t instanceof Error?t.message:"Registration failed")}}async exchangeTokenForBackendToken(s){console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] Backend URL:",`${de}/auth/login`),console.log("[AuthService] Request payload:",{clientId:this.config.clientId,tenantId:this.config.tenantId,hasToken:!!s,tokenLength:s?.length});try{const t=await fetch(`${de}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({msalToken:s,clientId:this.config.clientId,tenantId:this.config.tenantId})});if(console.log("[AuthService] Backend response status:",t.status),console.log("[AuthService] Backend response headers:",Object.fromEntries(t.headers.entries())),!t.ok){const n=await t.json().catch(()=>({}));throw console.error("[AuthService] Backend error response:",n),new Error(n.error||`Backend authentication failed with status ${t.status}`)}const r=await t.json();if(console.log("[AuthService] Backend success response:",{hasUser:!!r.user,hasToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,hasExpiresAt:!!r.expiresAt,userEmail:r.user?.email,expiresAt:r.expiresAt,accessTokenLength:r.accessToken?.length,refreshTokenLength:r.refreshToken?.length}),console.log("[AuthService] Full backend response:",r),console.log("[AuthService] Response keys:",Object.keys(r)),!r.accessToken||!r.refreshToken||!r.expiresAt){if(console.error("[AuthService] Backend response missing required fields:",{hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,hasExpiresAt:!!r.expiresAt,availableKeys:Object.keys(r)}),console.warn("[AuthService] Attempting to handle missing fields..."),!r.accessToken)throw new Error("Backend response is missing access token");const n=new Date;n.setDate(n.getDate()+7);const o="temp-refresh-token-"+Date.now();console.log("[AuthService] Using default values:",{expiresAt:n.toISOString(),refreshToken:o});const m={...r,refreshToken:r.refreshToken||o,expiresAt:r.expiresAt||n.toISOString()};return this.setTokens(m.accessToken,m.refreshToken,m.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),m}return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),r}catch(t){throw console.error("[AuthService] Fetch error:",t),new Error(`Network error: ${t instanceof Error?t.message:"Unknown error"}`)}}async logout(){try{console.log("[AuthService] Starting logout process..."),await this.clearBackendSession(),console.log("[AuthService] Backend session cleared"),this.clearAllAuthData(),console.log("[AuthService] All authentication data cleared");try{window.msalInstance&&typeof window.msalInstance.clearCache=="function"&&(window.msalInstance.clearCache(),console.log("[AuthService] MSAL cache cleared"))}catch(s){console.warn("[AuthService] MSAL cache clear failed, but tokens cleared:",s)}console.log("[AuthService] Logout completed successfully")}catch(s){console.error("[AuthService] Logout error:",s),this.clearAllAuthData()}}async clearBackendSession(){try{const s=this.getAccessToken();s&&await fetch(`${de}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})}catch(s){console.error("Error clearing backend session:",s)}}async getCurrentUser(){try{const s=this.getAccessToken();if(!s)return null;const t=await fetch(`${de}/auth/me`,{headers:{Authorization:`Bearer ${s}`}});return t.ok?t.json():t.status===401&&await this.refreshToken()?this.getCurrentUser():(this.clearTokens(),null)}catch(s){return console.error("Error getting current user:",s),this.clearTokens(),null}}async refreshToken(){try{const s=this.getRefreshToken();if(!s)return this.clearTokens(),!1;const t=await fetch(`${de}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:s})});if(!t.ok)return this.clearTokens(),!1;const r=await t.json();return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),!0}catch(s){return console.error("Error refreshing token:",s),this.clearTokens(),!1}}isAuthenticated(){const s=this.getAccessToken(),t=this.getExpiresAt();if(console.log("[AuthService] Checking authentication:",{hasToken:!!s,hasExpiresAt:!!t,expiresAt:t,currentTime:new Date().toISOString(),tokenExpiry:t?new Date(t).toISOString():"N/A",isExpired:t?new Date(t)<=new Date:"N/A"}),!s||!t)return console.log("[AuthService] Authentication failed: missing token or expiry"),!1;const r=new Date,o=new Date(t)>r;return o||(console.log("[AuthService] Token expired, clearing stale tokens"),this.clearTokens()),console.log("[AuthService] Token validity check:",{isValid:o}),o}getAccessToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}getExpiresAt(){return localStorage.getItem("expiresAt")}setTokens(s,t,r){console.log("[AuthService] Setting tokens in localStorage:",{hasAccessToken:!!s,hasRefreshToken:!!t,expiresAt:r,accessTokenLength:s?.length,refreshTokenLength:t?.length}),localStorage.setItem("accessToken",s),localStorage.setItem("refreshToken",t),localStorage.setItem("expiresAt",r),console.log("[AuthService] Tokens stored, verification:",{storedAccessToken:!!localStorage.getItem("accessToken"),storedRefreshToken:!!localStorage.getItem("refreshToken"),storedExpiresAt:localStorage.getItem("expiresAt")})}clearTokens(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("expiresAt")}clearAllAuthData(){console.log("[AuthService] Clearing all authentication data..."),this.clearTokens();try{localStorage.removeItem("user"),console.log("[AuthService] User data cleared from localStorage")}catch(t){console.warn("[AuthService] Could not clear user data:",t)}try{it(async()=>{const{historyService:t}=await Promise.resolve().then(()=>Ut);return{historyService:t}},void 0).then(({historyService:t})=>{t.clearUserData(),console.log("[AuthService] User-specific history data cleared")}).catch(t=>{console.warn("[AuthService] Could not clear user history data:",t)})}catch(t){console.warn("[AuthService] Could not clear user history data:",t)}["llm_qa_current_session","structure_last_saved","overview_market_analysis","llm_qa_sessions"].forEach(t=>{try{localStorage.getItem(t)&&(console.log(`[AuthService] Clearing conflicting localStorage key: ${t}`),localStorage.removeItem(t))}catch(r){console.warn(`[AuthService] Could not clear ${t}:`,r)}}),console.log("[AuthService] All authentication data cleared (history preserved)")}getAuthHeaders(){const s=this.getAccessToken();return s?{Authorization:`Bearer ${s}`}:{}}getCurrentUserFromStorage(){try{const s=localStorage.getItem("user");if(s)return JSON.parse(s)}catch(s){console.warn("[AuthService] Error parsing user data from localStorage:",s)}return null}getCurrentUserId(){try{return this.getCurrentUserFromStorage()?.id||null}catch(s){return console.warn("[AuthService] Error getting user ID from localStorage:",s),null}}}const V=new Mt;class $t{getStorageKey(s){const t=V.getCurrentUserId();return t?`${s}_${t}`:`${s}_anonymous`}getHistoryKey(){return this.getStorageKey("comprehensive_history")}async addHistoryItem(s){try{console.log("[HistoryService] Adding history item to localStorage:",s);const t=this.getHistoryKey(),r=this.getHistoryFromStorage(t),n=[s,...r];localStorage.setItem(t,JSON.stringify(n)),console.log("[HistoryService] History item saved successfully to localStorage")}catch(t){throw console.error("[HistoryService] Error saving history item to localStorage:",t),t}}async getHistoryItems(){try{const s=this.getHistoryKey(),t=this.getHistoryFromStorage(s);return console.log("[HistoryService] Retrieved history items from localStorage:",t.length),t}catch(s){return console.error("[HistoryService] Error getting history items from localStorage:",s),[]}}async clearHistory(){try{console.log("[HistoryService] Clearing history from localStorage...");const s=this.getHistoryKey();localStorage.removeItem(s),console.log("[HistoryService] History cleared successfully from localStorage")}catch(s){throw console.error("[HistoryService] Error clearing history from localStorage:",s),s}}async deleteHistoryItem(s){try{console.log("[HistoryService] Deleting history item from localStorage:",s);const t=this.getHistoryKey(),n=this.getHistoryFromStorage(t).filter(o=>o.id!==s);localStorage.setItem(t,JSON.stringify(n)),console.log("[HistoryService] History item deleted successfully from localStorage")}catch(t){throw console.error("[HistoryService] Error deleting history item from localStorage:",t),t}}async exportHistoryItem(s){try{console.log("[HistoryService] Exporting history item from localStorage:",s);const t=this.getHistoryKey(),n=this.getHistoryFromStorage(t).find(k=>k.id===s);if(!n)return null;const o=JSON.stringify(n,null,2),m=`${n.type}_${n.id}.json`;return console.log("[HistoryService] History item exported successfully from localStorage"),{content:o,filename:m,mimeType:"application/json"}}catch(t){return console.error("[HistoryService] Error exporting history item from localStorage:",t),null}}async exportAllHistory(){try{console.log("[HistoryService] Exporting all history from localStorage...");const s=this.getHistoryKey(),t=this.getHistoryFromStorage(s),r=JSON.stringify(t,null,2),n=`all_history_${new Date().toISOString().split("T")[0]}.json`;return console.log("[HistoryService] All history exported successfully from localStorage"),{content:r,filename:n,mimeType:"application/json"}}catch(s){return console.error("[HistoryService] Error exporting all history from localStorage:",s),{content:"[]",filename:"empty_history.json",mimeType:"application/json"}}}async clearUserData(){try{console.log("[HistoryService] Clearing user data from localStorage..."),V.getCurrentUserId()&&([this.getStorageKey("comprehensive_history"),this.getStorageKey("qa_history"),this.getStorageKey("ai_visibility_history"),this.getStorageKey("content_analysis_history"),this.getStorageKey("structure_analysis_history")].forEach(r=>{localStorage.removeItem(r)}),console.log("[HistoryService] User data cleared successfully from localStorage"))}catch(s){throw console.error("[HistoryService] Error clearing user data from localStorage:",s),s}}getHistoryFromStorage(s){try{const t=localStorage.getItem(s);return t?JSON.parse(t):[]}catch(t){return console.error("[HistoryService] Error parsing history from localStorage:",t),[]}}}const ae=new $t,Ut=Object.freeze(Object.defineProperty({__proto__:null,historyService:ae},Symbol.toStringTag,{value:"Module"}));function Ht(l){const s=["good","great","excellent","amazing","wonderful","fantastic","positive","helpful","useful","clear","effective","beneficial","advantageous","superior","quality","reliable","efficient","powerful","comprehensive","detailed","accurate","professional","innovative","advanced","secure","fast","easy","simple","convenient","flexible","scalable","robust","stable","trusted","proven","award-winning","leading","premium","exclusive","cutting-edge","modern","user-friendly","intuitive","seamless","smooth","responsive","optimized","enhanced","improved","upgraded","streamlined"],t=["bad","terrible","awful","horrible","negative","unclear","confusing","useless","ineffective","poor","unreliable","slow","difficult","complex","outdated","limited","restrictive","expensive","risky","unstable","buggy","glitchy","broken","faulty","defective","inferior","substandard","mediocre","disappointing","frustrating","annoying","problematic","troublesome","cumbersome","clunky","awkward","unintuitive","complicated","overwhelming","stressful"],r=["solution","platform","service","product","feature","capability","functionality","performance","reliability","security","support","documentation","integration","automation","optimization","efficiency","productivity","growth","success","achievement","innovation","technology","development","improvement","enhancement","upgrade","update","maintenance","monitoring","analytics"],n=["issue","problem","error","bug","failure","crash","downtime","outage","disruption","delay","limitation","constraint","restriction","barrier","obstacle","challenge","difficulty","complexity","confusion","uncertainty","risk","threat","vulnerability","weakness","deficiency","shortcoming","drawback","disadvantage","inconvenience","frustration"],o=l.toLowerCase().split(/\s+/);let m=0,k=0;o.length,o.forEach(S=>{const F=S.replace(/[^\w]/g,"");F.length<3||(s.includes(F)?m+=1:r.includes(F)&&(m+=.5),t.includes(F)?k+=1:n.includes(F)&&(k+=.5))});const g=m+k;if(g===0)return"Neutral";const c=m/g,h=k/g;return c>.6?"Positive":h>.6?"Negative":"Neutral"}function Ce(l,s,t){let r=0;const n=[];console.log("[Apply Suggestions] Starting to apply suggestions:",{htmlLength:l.length,suggestionsCount:s.length,suggestions:s.map(g=>({type:g.type,hasExactReplacement:!!g.exactReplacement}))}),s.forEach(g=>{try{if(g.exactReplacement){const{find:c,replace:h}=g.exactReplacement;console.log(`[Apply Suggestions] Applying ${g.type}:`,{find:c.substring(0,100)+"...",replace:h.substring(0,100)+"...",found:l.includes(c)}),l.includes(c)?(l=l.replace(c,h),r++,n.push(`${g.type} applied with exact replacement`),console.log(`[Apply Suggestions] Successfully applied ${g.type}`)):console.log(`[Apply Suggestions] Could not find pattern for ${g.type}`)}}catch(c){console.warn(`Failed to apply exact replacement for ${g.type}:`,c)}});let o;try{if(o=new window.DOMParser().parseFromString(l,"text/html"),o.querySelector("parsererror"))return console.warn("[Apply Suggestions] HTML parsing errors detected, using fallback approach"),l}catch(g){return console.error("[Apply Suggestions] Error parsing HTML:",g),l}const m=(g,c,h)=>{if(!c||!h)return 0;let S=0;const F=g.createTreeWalker?g.createTreeWalker(g.body||g,NodeFilter.SHOW_TEXT):o.createTreeWalker(g.body||o.body,NodeFilter.SHOW_TEXT);let E;for(;E=F.nextNode();)E.textContent&&E.textContent.includes(c)&&(E.textContent=E.textContent.replaceAll(c,h),t?.highlight&&E.parentElement&&E.parentElement.setAttribute("data-ai-updated","true"),S++);return S};if(o.querySelectorAll('style, link[rel="stylesheet"]'),o.querySelectorAll("script"),o.querySelector("header, nav, .header, .navbar, .navigation"),o.querySelector("footer, .footer"),s.forEach(g=>{try{if(g.exactReplacement&&l.includes(g.exactReplacement.replace))return;if(g.type==="heading"){const c=(g.enhancedContent||g.implementation||"").trim(),h=(g.currentContent||"").trim();if(c.length>0){const S=Array.from(o.querySelectorAll("h1,h2,h3"));let F=!1;S.forEach(E=>{const P=(E.textContent||"").trim();(h&&P.includes(h)||!h&&E.tagName.toLowerCase()==="h1")&&(E.textContent=c,t?.highlight&&E.setAttribute("data-ai-updated","true"),F=!0)}),F&&(r++,n.push("Heading updated"))}}if(g.type==="paragraph"){const{currentContent:c,enhancedContent:h}=g;if(c&&h){let S=!1;o.querySelectorAll("p").forEach(E=>{E.textContent&&E.textContent.includes(c)&&(E.textContent=(E.textContent||"").replaceAll(c,h),t?.highlight&&E.setAttribute("data-ai-updated","true"),S=!0)}),S||(S=m(o,c,h)>0),S&&(r++,n.push("Paragraph content replaced"))}}if(g.type==="list"){const{currentContent:c,enhancedContent:h}=g;if(c&&h){const S=o.querySelectorAll("li");let F=!1;S.forEach(E=>{E.textContent&&E.textContent.includes(c)&&(E.textContent=E.textContent.replace(c,h),t?.highlight&&E.setAttribute("data-ai-updated","true"),F=!0)}),F||(F=m(o,c,h)>0),F&&(r++,n.push("List item content replaced"))}}if(g.type==="meta_description"){let c=o.querySelector('meta[name="description"]');c||(c=o.createElement("meta"),c.name="description",o.head.appendChild(c));const h=o.querySelector("p")?.textContent||"";c.content=h.substring(0,160)||"Improved meta description.",r++,n.push("Meta description updated")}if(g.type==="title"){let c=o.querySelector("title");c||(c=o.createElement("title"),o.head.appendChild(c));const h=o.querySelector("h1")?.textContent;c.textContent=h||"Improved Title",r++,n.push("Title updated")}if(g.type==="meta_keywords"){let c=o.querySelector('meta[name="keywords"]');c||(c=o.createElement("meta"),c.name="keywords",o.head.appendChild(c));const F=(o.body.textContent||"").split(/\s+/).filter(P=>P.length>4).reduce((P,J)=>(P[J.toLowerCase()]=(P[J.toLowerCase()]||0)+1,P),{}),E=Object.entries(F).sort(([,P],[,J])=>J-P).slice(0,5).map(([P])=>P);c.content=E.join(", "),r++,n.push("Meta keywords updated")}if(g.type==="meta_viewport"){let c=o.querySelector('meta[name="viewport"]');c||(c=o.createElement("meta"),c.name="viewport",o.head.appendChild(c)),c.content="width=device-width, initial-scale=1.0",r++,n.push("Meta viewport updated")}if(g.type==="og_title"){let c=o.querySelector('meta[property="og:title"]');c||(c=o.createElement("meta"),c.setAttribute("property","og:title"),o.head.appendChild(c)),c.content=o.querySelector("h1")?.textContent||o.querySelector("title")?.textContent||"",r++,n.push("Open Graph title added")}if(g.type==="og_description"){let c=o.querySelector('meta[property="og:description"]');c||(c=o.createElement("meta"),c.setAttribute("property","og:description"),o.head.appendChild(c)),c.content=o.querySelector('meta[name="description"]')?.getAttribute("content")||"",r++,n.push("Open Graph description added")}if(g.type==="canonical"){let c=o.querySelector('link[rel="canonical"]');c||(c=o.createElement("link"),c.rel="canonical",o.head.appendChild(c)),c.href=window.location.href,r++,n.push("Canonical URL added")}if(g.type==="lang_attribute"){const c=o.documentElement;c.lang="en",r++,n.push("Language attribute updated")}if(g.type==="keyword_optimization"){const c=g.enhancedContent||g.implementation||"",h=c.match(/Enhanced with keywords:\s*(.+)/i)||c.match(/Add keywords:\s*(.+)/i);if(h&&h[1]){let S=o.querySelector('meta[name="keywords"]');S||(S=o.createElement("meta"),S.name="keywords",o.head.appendChild(S)),S.content=h[1],r++,n.push("Meta keywords updated")}}if(g.type==="content_enhancement"){const c=o.querySelectorAll("p");if(c.length>0){const h=c[0],S=g.enhancedContent;S&&S.length>10&&(h.textContent=S,r++,n.push("Content enhanced for AI understanding"))}}if(g.type==="sentence_replacement"){const c=g.currentContent,h=g.enhancedContent;c&&h&&m(o,c,h)>0&&(r++,n.push("Sentence replaced for better AI understanding"))}if(g.type==="ai_content_restructure"){const{currentContent:c,enhancedContent:h}=g;c&&h&&m(o,c,h)>0&&(r++,n.push("Content restructured"))}}catch(c){console.warn(`Failed to apply suggestion ${g.type}:`,c)}}),r>0){const g=o.createElement("script");g.type="application/json",g.id="ai-change-summary",g.textContent=JSON.stringify({appliedCount:r,appliedSuggestions:n}),o.head.appendChild(g)}let k=o.documentElement.outerHTML;if(k.includes("viewport")||(k=k.replace("</head>",`    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>`)),k.includes("<!DOCTYPE html>")||(k=`<!DOCTYPE html>
`+k),t?.highlight){const g=o.createElement("style");g.textContent=`
    [data-ai-updated="true"] { background: #ecfdf5 !important; outline: 2px solid #10b98133; }
    `,o.head.appendChild(g)}return k}const lt="statistics_state";function gs({sessions:l,currentSession:s}){const[t,r]=f.useState("7d"),[n,o]=f.useState("questions"),[m,k]=f.useState([]),[g,c]=f.useState(0),[h,S]=f.useState([]),[F]=f.useState(!1);f.useEffect(()=>{(async()=>{try{const b=await ae.getHistoryItems();k(b);const C=JSON.parse(localStorage.getItem("sessions")||"[]");S(C);const _=localStorage.getItem("llm_qa_current_session");if(_)try{const D=JSON.parse(_);console.log("[Statistics] Current session loaded:",{id:D.id,qaDataLength:D.qaData?.length||0})}catch(D){console.error("[Statistics] Error parsing current session:",D)}}catch(b){console.error("[Statistics] Error loading history items:",b),k([])}})()},[g,l.length,s]),f.useEffect(()=>{s&&(console.log("[Statistics] Current session prop changed:",{id:s.id,qaDataLength:s.qaData?.length||0,timestamp:s.timestamp}),c(y=>y+1))},[s?.id,s?.qaData?.length,s?.timestamp]),f.useEffect(()=>{const y=D=>{(D.key==="comprehensive_history"||D.key==="sessions"||D.key==="llm_qa_current_session")&&(console.log("[Statistics] Storage changed:",D.key,"refreshing statistics"),c(R=>R+1))};window.addEventListener("storage",y);const C=setInterval(()=>{const D=localStorage.getItem("llm_qa_current_session");if(D)try{const w=JSON.parse(D).qaData?.length||0;if(s&&s.qaData){const A=s.qaData.length;w!==A&&(console.log("[Statistics] Current session QA count changed:",A,"->",w),c(u=>u+1))}}catch(R){console.error("[Statistics] Error checking current session changes:",R)}},1e3),_=setInterval(async()=>{try{const D=await ae.getHistoryItems(),R=JSON.parse(localStorage.getItem("sessions")||"[]");(D.length!==m.length||R.length!==h.length)&&(console.log("[Statistics] Data changed, refreshing statistics"),c(w=>w+1))}catch(D){console.error("[Statistics] Error checking for data changes:",D)}},2e3);return()=>{window.removeEventListener("storage",y),clearInterval(C),clearInterval(_)}},[m.length,h.length,s]);const E=()=>{const y=[...l,...h];m.forEach(a=>{if(a.type==="qa"){const i=a;y.push(i.sessionData)}});const C=m.filter(a=>a.type==="ai-visibility").map(a=>a),D=m.filter(a=>a.type==="content-analysis").map(a=>a),w=m.filter(a=>a.type==="structure-analysis").map(a=>a);console.log("[Statistics] Analysis types found:",{qaSessions:y.length,aiVisibilityAnalyses:C.length,contentAnalyses:D.length,structureAnalyses:w.length});const A=y.filter((a,i,p)=>i===p.findIndex(I=>I.id===a.id));if(console.log("[Statistics] Total sessions for calculation:",A.length),console.log("[Statistics] Sessions from prop:",l.length),console.log("[Statistics] Sessions from localStorage:",h.length),console.log("[Statistics] QA items from history:",m.filter(a=>a.type==="qa").length),A.forEach((a,i)=>{console.log(`[Statistics] Session ${i+1}:`,{id:a.id,qaCount:a.qaData.length,totalCost:a.statistics?.totalCost,timestamp:a.timestamp})}),!(A.length>0||C.length>0||D.length>0||w.length>0))return{totalQuestions:0,totalCost:0,totalTokens:0,avgAccuracy:0,totalSessions:0,avgQuestionsPerSession:0,successRate:0,providerDistribution:{},questionsPerDay:[],inputTokens:0,outputTokens:0,avgResponseTime:0,weeklyGrowth:0,dailyAverage:0,peakDay:"",sentimentDistribution:{positive:0,negative:0,neutral:0},geoScoreAverage:0,semanticRelevanceAverage:0,vectorSimilarityAverage:0,totalAIVisibilityAnalyses:0,totalContentAnalyses:0,totalStructureAnalyses:0,averageVisibilityScore:0,averageSEOScore:0,averageReadabilityScore:0,totalSuggestions:0};const z=A.reduce((a,i)=>a+i.qaData.length,0),K=A.reduce((a,i)=>a+parseFloat(i.statistics?.totalCost||"0"),0),B=A.reduce((a,i)=>a+i.qaData.reduce((p,I)=>p+I.totalTokens,0),0),M=A.reduce((a,i)=>a+i.qaData.reduce((p,I)=>p+I.inputTokens,0),0),W=A.reduce((a,i)=>a+i.qaData.reduce((p,I)=>p+I.outputTokens,0),0),ee=C.length,oe=C.length>0?C.reduce((a,i)=>a+(i.analysis.summary.averageVisibilityScore||0),0)/C.length:0,Ee=D.length,he=D.length>0?D.reduce((a,i)=>a+(i.analysis.seoScore||0),0)/D.length:0,pe=D.length>0?D.reduce((a,i)=>a+(i.analysis.readabilityScore||0),0)/D.length:0,ue=w.length,ge=w.reduce((a,i)=>a+(i.analysis.suggestions?.length||0),0);console.log("[Statistics] Calculated metrics:",{totalQuestions:z,totalCost:K.toFixed(5),totalTokens:B,sessionCount:y.length});const me=A.flatMap(a=>a.qaData),x=me.map(a=>parseFloat(a.accuracy||"0")).filter(a=>!isNaN(a)&&a>0),j=x.length>0?x.reduce((a,i)=>a+i,0)/x.length:0;console.log("[Statistics] Accuracy calculation:",{totalQAItems:me.length,itemsWithAccuracy:x.length,avgAccuracy:j.toFixed(1)+"%",accuracyValues:x.slice(0,5)});const d={};["openai","gemini","perplexity"].forEach(a=>{d[a]=0}),me.forEach(a=>{const i=a.provider||"Unknown";d.hasOwnProperty(i)?d[i]++:d[i]=(d[i]||0)+1});const q={positive:0,negative:0,neutral:0},ie=A[0]?.blogContent||"";if(ie)try{const a=Ht(ie);a==="Negative"?(q.positive=0,q.negative=0,q.neutral=80):a==="Positive"?(q.positive=70,q.negative=0,q.neutral=30):(q.positive=0,q.negative=0,q.neutral=100)}catch(a){console.error("Error calculating sentiment:",a),q.positive=0,q.negative=0,q.neutral=100}else q.positive=0,q.negative=0,q.neutral=100;const se=me.map(a=>a.geoScore||0).filter(a=>a>0),le=se.length>0?se.reduce((a,i)=>a+i,0)/se.length:0,X=me.map(a=>parseFloat(a.semanticRelevance||"0")).filter(a=>!isNaN(a)&&a>0),ce=X.length>0?X.reduce((a,i)=>a+i,0)/X.length:0,fe=me.map(a=>{const i=a.vectorSimilarity;return typeof i=="string"&&i.includes("%")?parseFloat(i.replace("%","")):parseFloat(i||"0")}).filter(a=>!isNaN(a)&&a>0),Pe=fe.length>0?fe.reduce((a,i)=>a+i,0)/fe.length:0,Ie=new Date,Fe=new Date(Ie.getTime()-7*24*60*60*1e3),Re=new Date(Ie.getTime()-14*24*60*60*1e3),je=A.filter(a=>new Date(a.timestamp)>=Fe),Me=A.filter(a=>new Date(a.timestamp)>=Re&&new Date(a.timestamp)<Fe),$e=je.reduce((a,i)=>a+i.qaData.length,0),Ne=Me.reduce((a,i)=>a+i.qaData.length,0),Ue=Ne>0?($e-Ne)/Ne*100:0,De=z/7,ve=P(y,7),Le=ve.indexOf(Math.max(...ve)),qe=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Le]||"Unknown",Be=A.filter(a=>a.qaData.some(i=>i.answer&&i.answer.trim()!=="")),Ve=A.length>0?Be.length/A.length*100:0,we=A.length>0?z/A.length:0,ze=B>0?B/1e3*2.5:0;return{totalQuestions:z,totalCost:K,totalTokens:B,avgAccuracy:j,totalSessions:A.length,avgQuestionsPerSession:we,successRate:Ve,providerDistribution:d,questionsPerDay:ve,inputTokens:M,outputTokens:W,avgResponseTime:ze,weeklyGrowth:Ue,dailyAverage:De,peakDay:qe,sentimentDistribution:q,geoScoreAverage:le,semanticRelevanceAverage:ce,vectorSimilarityAverage:Pe,totalAIVisibilityAnalyses:ee,totalContentAnalyses:Ee,totalStructureAnalyses:ue,averageVisibilityScore:oe,averageSEOScore:he,averageReadabilityScore:pe,totalSuggestions:ge}},P=(y,b)=>{const C=new Date,_=[];for(let D=b-1;D>=0;D--){const R=new Date(C);R.setDate(R.getDate()-D);const A=y.filter(u=>{const z=new Date(u.timestamp);return z.getFullYear()===R.getFullYear()&&z.getMonth()===R.getMonth()&&z.getDate()===R.getDate()}).reduce((u,z)=>u+z.qaData.length,0);_.push(A)}return _},J=()=>{const y=new Date,b=[],C=[],_=["#000000","#333333","#666666","#999999","#cccccc","#e6e6e6","#f0f0f0","#1a1a1a","#404040","#595959","#737373","#8c8c8c","#a6a6a6","#bfbfbf","#d9d9d9","#e6e6e6","#f2f2f2","#f5f5f5","#f8f8f8","#fafafa","#fcfcfc","#000000","#1a1a1a","#333333","#4d4d4d","#666666","#808080","#999999"],D=[...l];switch(m.forEach(R=>{if(R.type==="qa"){const w=R;D.push(w.sessionData)}}),t){case"7d":console.log("[Statistics] Generating 7-day chart data...");for(let R=6;R>=0;R--){const w=new Date(y);w.setDate(w.getDate()-R);const A=w.toLocaleDateString("en-US",{weekday:"short"});b.push(A),console.log(`[Statistics] Day ${R}: ${A} - ${w.toISOString()}`),new Date(w).setHours(0,0,0,0),new Date(w).setHours(23,59,59,999);const K=D.filter(B=>{try{const M=new Date(B.timestamp);if(isNaN(M.getTime()))return console.warn("[Statistics] Invalid session timestamp:",B.timestamp),!1;const W=M.getFullYear()*1e4+(M.getMonth()+1)*100+M.getDate(),ee=w.getFullYear()*1e4+(w.getMonth()+1)*100+w.getDate();return W===ee}catch(M){return console.error("[Statistics] Error parsing session timestamp:",B.timestamp,M),!1}});if(n==="questions"){const B=K.reduce((M,W)=>M+W.qaData.length,0);console.log(`[Statistics] Day ${b[b.length-1]}: ${K.length} sessions, ${B} questions`),C.push(B)}else if(n==="cost"){const B=K.reduce((M,W)=>M+parseFloat(W.statistics?.totalCost||"0"),0);C.push(B)}else n==="sessions"&&C.push(K.length)}break;case"30d":console.log("[Statistics] Generating 30-day chart data...");for(let R=29;R>=0;R--){const w=new Date(y);w.setDate(w.getDate()-R);const A=w.toLocaleDateString("en-US",{month:"short",day:"numeric"});b.push(A),console.log(`[Statistics] Day ${R}: ${A} - ${w.toISOString()}`),new Date(w).setHours(0,0,0,0),new Date(w).setHours(23,59,59,999);const K=D.filter(B=>{try{const M=new Date(B.timestamp);if(isNaN(M.getTime()))return console.warn("[Statistics] Invalid session timestamp:",B.timestamp),!1;const W=M.getFullYear()*1e4+(M.getMonth()+1)*100+M.getDate(),ee=w.getFullYear()*1e4+(w.getMonth()+1)*100+w.getDate();return W===ee}catch(M){return console.error("[Statistics] Error parsing session timestamp:",B.timestamp,M),!1}});if(n==="questions"){const B=K.reduce((M,W)=>M+W.qaData.length,0);console.log(`[Statistics] Day ${b[b.length-1]}: ${K.length} sessions, ${B} questions`),C.push(B)}else if(n==="cost"){const B=K.reduce((M,W)=>M+parseFloat(W.statistics?.totalCost||"0"),0);C.push(B)}else n==="sessions"&&C.push(K.length)}break}return{labels:b,values:C,colors:_}},T=E(),U=J(),Z=[...l];if(m.forEach(y=>{if(y.type==="qa"){const b=y;Z.push(b.sessionData)}}),Z.length>0){const y=Z[0];console.log("[Statistics] Sample session structure:",{id:y.id,timestamp:y.timestamp,qaDataLength:y.qaData.length,qaDataSample:y.qaData.slice(0,2).map(b=>({question:b.question.substring(0,50)+"...",hasAnswer:!!b.answer}))})}console.log("[Statistics] Sessions from prop:",l.length),console.log("[Statistics] QA items from history:",m.filter(y=>y.type==="qa").length),console.log("[Statistics] Total sessions for stats:",Z.length),console.log("[Statistics] Current session QA count:",s?.qaData.length||0),console.log("[Statistics] Chart data:",U),console.log("[Statistics] Provider distribution:",T.providerDistribution),s&&console.log("[Statistics] Current session active:",{id:s.id,qaDataLength:s.qaData?.length||0}),Z.length>0&&console.log("[Statistics] Sample session timestamps:",Z.slice(0,3).map(y=>({id:y.id,timestamp:y.timestamp,qaDataLength:y.qaData.length,date:new Date(y.timestamp).toLocaleDateString()})));const Q=U.values.length>0?Math.max(...U.values,1):1;if(!U.values.some(y=>y>0)&&Z.length>0)if(console.log("[Statistics] No data found in chart, showing fallback data"),s&&s.qaData.length>0){const y=s.qaData.length,b=Math.ceil(y/7);U.values=U.values.map((C,_)=>_===0?Math.floor(b*.8):_===1?Math.floor(b*1.2):_===2?Math.floor(b*1):_===3?Math.floor(b*.9):_===4?Math.floor(b*1.1):_===5?Math.floor(b*.7):_===6?Math.floor(b*.6):0)}else{const y=l.reduce((b,C)=>b+C.qaData.length,0);if(y>0){const b=Math.ceil(y/7);U.values=U.values.map((C,_)=>_===0?Math.floor(b*.8):_===1?Math.floor(b*1.2):_===2?Math.floor(b*1):_===3?Math.floor(b*.9):_===4?Math.floor(b*1.1):_===5?Math.floor(b*.7):_===6?Math.floor(b*.6):0)}}const te=T.providerDistribution,v=["#000000","#333333","#666666","#999999","#cccccc","#e6e6e6"],L=y=>({openai:"ChatGPT",gemini:"Gemini",perplexity:"Perplexity",Unknown:"Unknown"})[y]||y;return f.useEffect(()=>{const y=localStorage.getItem(lt);if(y)try{const b=JSON.parse(y);b.timeRange&&r(b.timeRange),b.selectedMetric&&o(b.selectedMetric)}catch{}},[]),f.useEffect(()=>{localStorage.setItem(lt,JSON.stringify({timeRange:t,selectedMetric:n}))},[t,n]),e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-black",children:"Live Analytics Dashboard"})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-black",children:T.totalQuestions}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Questions"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-black",children:T.totalAIVisibilityAnalyses+T.totalContentAnalyses+T.totalStructureAnalyses}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Analyses"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-black",children:[T.avgAccuracy.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Avg Accuracy"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-black",children:["$",parseFloat(T.totalCost).toFixed(5)]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Cost"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(et,{className:"w-6 h-6 text-black"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[n==="questions"?"Questions Generated":n==="cost"?"Cost Analysis":"Sessions Created"," - ",t==="7d"?"Last 7 Days":"Last 30 Days",t==="30d"&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Scroll to see all days)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t,onChange:y=>r(y.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"7d",children:"7 Days"}),e.jsx("option",{value:"30d",children:"30 Days"})]}),e.jsxs("select",{value:n,onChange:y=>o(y.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"questions",children:"Questions"}),e.jsx("option",{value:"cost",children:"Cost"}),e.jsx("option",{value:"sessions",children:"Sessions"})]})]})]}),e.jsx("div",{className:`h-64 bg-gray-50 rounded-lg w-full ${t==="30d"?"overflow-x-auto":"overflow-hidden"}`,style:{...t==="30d"&&{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"}},children:e.jsxs("div",{className:"relative h-full flex items-end w-full",children:[t==="7d"&&e.jsx("div",{className:"absolute inset-0 flex items-end justify-between px-4 pb-8",children:U.values.map((y,b)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-16",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:n==="cost"?parseFloat(y).toFixed(5):y}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${y/Q*180}px`,backgroundColor:U.colors[b%U.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:U.labels[b]})]},b))}),t==="30d"&&e.jsx("div",{className:"flex items-end h-full gap-2 px-6 min-w-[1320px] pb-8",children:U.values.map((y,b)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-14",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:n==="cost"?parseFloat(y).toFixed(5):y}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${y/Q*180}px`,backgroundColor:U.colors[b%U.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:U.labels[b]})]},b))})]})}),t==="30d"&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("div",{className:"text-xs text-gray-500",children:"← Scroll horizontally to see all 30 days →"})})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ge,{className:"w-6 h-6 text-black"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Provider Distribution"})]}),Object.keys(te).length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:Object.entries(te).map(([y,b],C)=>{const _=Object.values(te).reduce((K,B)=>K+B,0),D=_>0?b/_*100:0,R=40,w=2*Math.PI*R,A=D/100*w,u=w-A,z=C/Object.keys(te).length*360;return e.jsx("circle",{cx:"50",cy:"50",r:R,fill:"none",stroke:v[C%v.length],strokeWidth:"8",strokeDasharray:w,strokeDashoffset:u,transform:`rotate(${z} 50 50)`,className:"transition-all duration-500"},y)})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:Object.values(te).reduce((y,b)=>y+b,0)}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"Total"})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mt-6",children:Object.entries(te).map(([y,b],C)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:v[C%v.length]}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:L(y)}),e.jsx("span",{className:"text-sm font-bold text-black ml-auto",children:b})]},y))})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-lg font-medium",children:"No provider data available"}),e.jsx("div",{className:"text-sm",children:"Generate some questions to see provider distribution"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(jt,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Token Usage"})]}),e.jsx("div",{className:"text-3xl font-bold text-black mb-2",children:T.totalTokens.toLocaleString()}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Total Tokens Used"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Input Tokens"}),e.jsx("span",{className:"text-black font-semibold",children:T.inputTokens.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Output Tokens"}),e.jsx("span",{className:"text-black font-semibold",children:T.outputTokens.toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ke,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Performance"})]}),e.jsx("div",{className:"text-3xl font-bold text-black mb-2",children:T.avgQuestionsPerSession.toFixed(1)}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Avg Questions/Session"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Success Rate"}),e.jsxs("span",{className:"text-black font-semibold",children:[T.successRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Avg Response Time"}),e.jsxs("span",{className:"text-black font-semibold",children:[T.avgResponseTime.toFixed(1),"s"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(et,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Trends"})]}),e.jsxs("div",{className:"text-3xl font-bold text-black mb-2",children:[T.weeklyGrowth>=0?"+":"",T.weeklyGrowth.toFixed(1),"%"]}),e.jsx("div",{className:"text-gray-600 font-medium",children:"This Week"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Daily Avg"}),e.jsx("span",{className:"text-black font-semibold",children:T.dailyAverage.toFixed(0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Peak Day"}),e.jsx("span",{className:"text-black font-semibold",children:T.peakDay})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Nt,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Sentiment Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:T.sentimentDistribution.positive}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Positive"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:T.sentimentDistribution.negative}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Negative"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:T.sentimentDistribution.neutral}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Neutral"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ke,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Quality Metrics"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"GEO Score Avg"}),e.jsxs("span",{className:"text-black font-semibold",children:[T.geoScoreAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Semantic Relevance"}),e.jsxs("span",{className:"text-black font-semibold",children:[T.semanticRelevanceAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vector Similarity"}),e.jsxs("span",{className:"text-black font-semibold",children:[T.vectorSimilarityAverage.toFixed(1),"%"]})]})]})]})]})]})}const qt=()=>{console.log("🧹 Clearing analysis data for fresh session..."),["llm_qa_current_session","llm_qa_current_work","enhance_content_state","ai_visibility_current_session","ai_visibility_analysis_data","content_analysis_current_session","content_analysis_data","structure_analysis_current_session","structure_analysis_data","llm_competitor_urls","session_index","session_manager_sessions","statistics_state","current_analysis_session","analysis_data","analysis_results"].forEach(t=>{try{localStorage.removeItem(t),console.log(`🧹 Cleared: ${t}`)}catch(r){console.warn(`🧹 Failed to clear ${t}:`,r)}}),["enhance_content_cache_","analysis_cache_","ai_visibility_","content_analysis_","structure_analysis_"].forEach(t=>{try{Object.keys(localStorage).forEach(n=>{n.startsWith(t)&&(localStorage.removeItem(n),console.log(`🧹 Cleared prefixed key: ${n}`))})}catch(r){console.warn(`🧹 Failed to clear keys with prefix ${t}:`,r)}}),console.log("🧹 Analysis data clearing completed")},Bt=l=>{console.log("🧹 Clearing user-specific data..."),console.log("🧹 User-specific data clearing completed")},Vt=()=>{console.log("🧹 Clearing analysis state...");try{sessionStorage.clear(),console.log("🧹 Cleared sessionStorage")}catch(l){console.warn("🧹 Failed to clear sessionStorage:",l)}console.log("🧹 Analysis state clearing completed")},ct=l=>{console.log("🧹 Performing analysis cleanup for fresh session..."),qt(),Bt(),Vt(),console.log("🧹 Analysis cleanup completed - ready for fresh analysis")},zt={isAuthenticated:!1,user:null,isLoading:!0,error:null};function Jt(l,s){switch(s.type){case"AUTH_START":return{...l,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...l,isAuthenticated:!0,user:s.payload.user,isLoading:!1,error:null};case"AUTH_FAILURE":return{...l,isAuthenticated:!1,user:null,isLoading:!1,error:s.payload};case"AUTH_LOGOUT":return{...l,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...l,error:null};default:return l}}const yt=f.createContext(void 0);function ms({children:l}){const[s,t]=f.useReducer(Jt,zt);f.useEffect(()=>{s.isAuthenticated&&s.user&&!s.isLoading&&console.log("🔐 AuthContext: User authenticated, should redirect to overview")},[s.isAuthenticated,s.user,s.isLoading]),f.useEffect(()=>{(async()=>{try{console.log("🔐 AuthContext: Checking authentication status on mount..."),t({type:"AUTH_START"});const c=new Date,h=V.getExpiresAt();if(h&&new Date(h)<=c){console.log("🔐 AuthContext: Token expired, clearing stale tokens"),V.clearTokens(),t({type:"AUTH_FAILURE",payload:null});return}if(V.isAuthenticated()){console.log("🔐 AuthContext: User is authenticated, getting user info...");const S=await V.getCurrentUser();if(S){console.log("🔐 AuthContext: User info retrieved, dispatching AUTH_SUCCESS");try{localStorage.setItem("user",JSON.stringify(S)),console.log("🔐 AuthContext: User data stored in localStorage on startup:",S)}catch(F){console.warn("🔐 AuthContext: Failed to store user data in localStorage on startup:",F)}t({type:"AUTH_SUCCESS",payload:{user:S,token:V.getAccessToken()}})}else console.log("🔐 AuthContext: Failed to get user info, clearing tokens"),V.clearTokens(),t({type:"AUTH_FAILURE",payload:"Failed to get user information"})}else console.log("🔐 AuthContext: User is not authenticated"),t({type:"AUTH_FAILURE",payload:null})}catch(c){console.error("🔐 AuthContext: Auth check error:",c),V.clearTokens(),t({type:"AUTH_FAILURE",payload:c instanceof Error?c.message:"Authentication failed"})}})()},[]);const k={...s,login:async(g="microsoft",c)=>{try{console.log("🔐 AuthContext: Starting login with method:",g),ct(),console.log("🔐 AuthContext: Clearing stale authentication data..."),V.clearTokens(),["llm_qa_current_session","structure_last_saved","overview_market_analysis"].forEach(P=>{try{localStorage.getItem(P)&&(console.log(`🔐 AuthContext: Clearing conflicting localStorage key: ${P}`),localStorage.removeItem(P))}catch(J){console.warn(`🔐 AuthContext: Could not clear ${P}:`,J)}}),t({type:"AUTH_START"});let S;switch(g){case"local":console.log("🔐 AuthContext: Using local login"),S=await V.localLogin(c);break;case"register":console.log("🔐 AuthContext: Using register method"),S=await V.register(c);break;case"google":console.log("🔐 AuthContext: Using Google login"),S=await V.googleLogin();break;case"microsoft":default:console.log("🔐 AuthContext: Using Microsoft login"),S=await V.login();break}console.log("✅ AuthContext: Login successful, dispatching AUTH_SUCCESS with:",{user:S.user,hasToken:!!S.accessToken}),console.log("🔐 AuthContext: Verifying token storage..."),await new Promise(P=>setTimeout(P,100));const F=V.isAuthenticated(),E=V.getAccessToken();if(console.log("🔐 AuthContext: Token verification:",{isAuthValid:F,hasStoredToken:!!E,tokenMatches:E===S.accessToken}),!F||!E){console.error("🔐 AuthContext: Token storage verification failed, clearing tokens and retrying..."),V.clearTokens(),V.setTokens(S.accessToken,S.refreshToken,S.expiresAt),await new Promise(T=>setTimeout(T,100));const P=V.isAuthenticated(),J=V.getAccessToken();if(console.log("🔐 AuthContext: Retry verification:",{isAuthValid:P,hasStoredToken:!!J,tokenMatches:J===S.accessToken}),!P||!J)throw new Error("Failed to store authentication tokens")}console.log("🔐 AuthContext: Dispatching AUTH_SUCCESS with user:",S.user);try{localStorage.setItem("user",JSON.stringify(S.user)),console.log("🔐 AuthContext: User data stored in localStorage:",S.user)}catch(P){console.warn("🔐 AuthContext: Failed to store user data in localStorage:",P)}t({type:"AUTH_SUCCESS",payload:{user:S.user,token:S.accessToken}}),console.log("🔐 AuthContext: AUTH_SUCCESS dispatched"),setTimeout(()=>{console.log("🔐 AuthContext: State after dispatch:",{isAuthenticated:V.isAuthenticated(),hasToken:!!V.getAccessToken(),user:V.getCurrentUser()})},100)}catch(h){console.error("❌ AuthContext: Login failed:",h),V.clearTokens(),t({type:"AUTH_FAILURE",payload:h instanceof Error?h.message:"Login failed"})}},logout:async()=>{try{await V.logout(),ct();try{localStorage.removeItem("user"),console.log("🔐 AuthContext: User data cleared from localStorage on logout")}catch(g){console.warn("🔐 AuthContext: Failed to clear user data from localStorage on logout:",g)}t({type:"AUTH_LOGOUT"})}catch(g){console.error("Logout error:",g),V.clearTokens();try{localStorage.removeItem("user"),console.log("🔐 AuthContext: User data cleared from localStorage on logout failure")}catch(c){console.warn("🔐 AuthContext: Failed to clear user data from localStorage on logout failure:",c)}t({type:"AUTH_LOGOUT"})}},clearError:()=>{t({type:"CLEAR_ERROR"})},refreshUser:async()=>{try{const g=await V.getCurrentUser();if(g){try{localStorage.setItem("user",JSON.stringify(g)),console.log("🔐 AuthContext: User data refreshed in localStorage:",g)}catch(c){console.warn("🔐 AuthContext: Failed to store refreshed user data in localStorage:",c)}t({type:"AUTH_SUCCESS",payload:{user:g,token:V.getAccessToken()}})}else V.clearTokens(),t({type:"AUTH_FAILURE",payload:"Failed to refresh user information"})}catch(g){V.clearTokens(),t({type:"AUTH_FAILURE",payload:g instanceof Error?g.message:"Failed to refresh user"})}}};return e.jsx(yt.Provider,{value:k,children:l})}function xt(){const l=f.useContext(yt);if(l===void 0)throw new Error("useAuth must be used within an AuthProvider");return l}const ft=/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F900}-\u{1F9FF}]|[\u{1F018}-\u{1F270}]|[\u{238C}-\u{2454}]|[\u{20D0}-\u{20FF}]|[\u{FE00}-\u{FE0F}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F64F}]|[\u{1F910}-\u{1F96B}]|[\u{1F980}-\u{1F9E0}]|[\u{1FA70}-\u{1FA93}]|[\u{1FAB0}-\u{1FABD}]|[\u{1FAC0}-\u{1FAF0}]|[\u{1FB00}-\u{1FB4B}]|[\u{1FB50}-\u{1FBAF}]|[\u{1FBB0}-\u{1FBCA}]|[\u{1FBD0}-\u{1FBEF}]|[\u{1FBF0}-\u{1FBFF}]|[\u{1FC00}-\u{1FC23}]|[\u{1FC30}-\u{1FC56}]|[\u{1FC60}-\u{1FC78}]|[\u{1FC80}-\u{1FC9C}]|[\u{1FCA0}-\u{1FCA4}]|[\u{1FCC0}-\u{1FCC4}]|[\u{1FCD0}-\u{1FCD4}]|[\u{1FCE0}-\u{1FCE4}]|[\u{1FCF0}-\u{1FCF4}]|[\u{1FD00}-\u{1FD23}]|[\u{1FD30}-\u{1FD56}]|[\u{1FD60}-\u{1FD78}]|[\u{1FD80}-\u{1FD9C}]|[\u{1FDA0}-\u{1FDA4}]|[\u{1FDB0}-\u{1FDB4}]|[\u{1FDC0}-\u{1FDC4}]|[\u{1FDD0}-\u{1FDD4}]|[\u{1FDE0}-\u{1FDE4}]|[\u{1FDF0}-\u{1FDF4}]|[\u{1FE00}-\u{1FE23}]|[\u{1FE30}-\u{1FE56}]|[\u{1FE60}-\u{1FE78}]|[\u{1FE80}-\u{1FE9C}]|[\u{1FEA0}-\u{1FEA4}]|[\u{1FEB0}-\u{1FEB4}]|[\u{1FEC0}-\u{1FEC4}]|[\u{1FED0}-\u{1FED4}]|[\u{1FEE0}-\u{1FEE4}]|[\u{1FEF0}-\u{1FEF4}]|[\u{1FF00}-\u{1FF23}]|[\u{1FF30}-\u{1FF56}]|[\u{1FF60}-\u{1FF78}]|[\u{1FF80}-\u{1FF9C}]|[\u{1FFA0}-\u{1FFA4}]|[\u{1FFB0}-\u{1FFB4}]|[\u{1FFC0}-\u{1FFC4}]|[\u{1FFD0}-\u{1FFD4}]|[\u{1FFE0}-\u{1FFE4}]|[\u{1FFF0}-\u{1FFF4}]/gu,vt=l=>!l||typeof l!="string"?l:l.replace(ft,""),We=(l,s)=>{const t=vt(l.target.value);return l.target.value=t,s(t),l.target.dispatchEvent(new Event("input",{bubbles:!0})),t},Ye=(l,s)=>{l.preventDefault();const t=l.clipboardData.getData("text"),r=vt(t),n=l.target;return n.value=r,s(r),n.dispatchEvent(new Event("input",{bubbles:!0})),r},Xe=l=>{if(l.key==="Backspace"||l.key==="Delete"||l.key==="ArrowLeft"||l.key==="ArrowRight"||l.key==="ArrowUp"||l.key==="ArrowDown"||l.key==="Tab"||l.key==="Enter"||l.key==="Escape"||l.key==="Home"||l.key==="End"||l.key==="PageUp"||l.key==="PageDown"||l.key==="Shift"||l.key==="Control"||l.key==="Alt"||l.key==="Meta")return!0;const s=l.key;return s.length===1&&ft.test(s)||(l.ctrlKey||l.metaKey||l.altKey)&&(s==="."||s===";"||s==="=")||s.length>1&&(s.includes("Emoji")||s.includes("emoji"))?(l.preventDefault(),!1):!0};function Te(l,s){const[t,r]=f.useState(()=>{try{const o=window.localStorage.getItem(l);return o?JSON.parse(o):s}catch(o){return console.error(`Error loading ${l} from localStorage:`,o),s}});return[t,o=>{try{r(o),window.localStorage.setItem(l,JSON.stringify(o))}catch(m){console.error(`Error saving ${l} to localStorage:`,m)}}]}const re="http://localhost:5000/api";class Gt{async request(s,t={}){const r=`${re}${s}`;console.log("[ApiService] Making request to:",r);const n=await fetch(r,{headers:{"Content-Type":"application/json",...V.getAuthHeaders(),...t.headers},...t});if(console.log("[ApiService] Response status:",n.status),console.log("[ApiService] Response headers:",n.headers),!n.ok){const m=await n.json().catch(()=>({}));throw new Error(m.error||`HTTP error! status: ${n.status}`)}const o=n.headers.get("content-type");if(!o||!o.includes("application/json")){const m=await n.text();throw console.error("[ApiService] Non-JSON response received:",m.substring(0,200)),new Error(`Expected JSON response but got: ${o}`)}return n.json()}async getLLMProviders(){return this.request("/llm/providers")}async generateQuestions(s){return this.request("/llm/generate-questions",{method:"POST",body:JSON.stringify(s)})}async generateAnswers(s){return this.request("/llm/generate-answers",{method:"POST",body:JSON.stringify(s)})}async generateAnswersWeb(s){return this.request("/llm/generate-answers-web",{method:"POST",body:JSON.stringify(s)})}async generateAIFAQs(s){return this.request("/llm/generate-ai-faqs",{method:"POST",body:JSON.stringify(s)})}async calculateConfidence(s,t,r,n){return this.request("/llm/calculate-confidence",{method:"POST",body:JSON.stringify({question:s,content:t,provider:r,model:n})})}async compareQuestions(s,t,r,n){return this.request("/llm/compare-questions",{method:"POST",body:JSON.stringify({question1:s,question2:t,provider:r,model:n})})}async saveSession(s){return this.request("/sessions",{method:"POST",body:JSON.stringify(s)})}async getSessionsByType(s){return this.request(`/sessions/${s}`)}async getSessionsWithFilters(s,t){const r=new URLSearchParams;t.fromDate&&r.append("fromDate",t.fromDate),t.toDate&&r.append("toDate",t.toDate),t.llmProvider&&r.append("llmProvider",t.llmProvider),t.llmModel&&r.append("llmModel",t.llmModel),t.blogLink&&r.append("blogLink",t.blogLink),t.search&&r.append("search",t.search);const n=r.toString(),o=n?`/sessions/${s}?${n}`:`/sessions/${s}`;return this.request(o)}async getSessionsByDateRange(s,t,r){const n=new URLSearchParams({fromDate:t,toDate:r});return this.request(`/sessions/${s}/range?${n}`)}async getSessionById(s){return this.request(`/sessions/question/${s}`)}async deleteSession(s){return this.request(`/sessions/${s}`,{method:"DELETE"})}async getSessionStats(s){return this.request(`/stats/${s}`)}async bulkSaveSessions(s){return this.request("/sessions/bulk",{method:"POST",body:JSON.stringify({sessions:s})})}async exportSessions(s,t="json"){const r=await fetch(`${re}/export/${s}?format=${t}`);if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(n.error||`HTTP error! status: ${r.status}`)}return r.blob()}async healthCheck(){return this.request("/health")}async migrateFromLocalStorage(s){const t=Object.values(s);return this.bulkSaveSessions(t)}async checkQuestionRelevance(s,t,r,n,o){return this.request("/questions/check-relevance",{method:"POST",body:JSON.stringify({sourceUrls:s,blogUrl:t,questionText:r,currentProvider:n,currentModel:o})})}async calculateCitationLikelihood({answer:s,content:t,provider:r,model:n}){console.log("[Frontend] Calling /api/citation-likelihood/calculate with:",{answer:s,content:t,provider:r,model:n});const o=await fetch(`${re}/citation-likelihood/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,provider:r,model:n})});let m;try{m=await o.json()}catch(k){throw console.error("[Frontend] Failed to parse JSON from /api/citation-likelihood/calculate:",k),new Error("Failed to parse JSON from /api/citation-likelihood/calculate")}if(console.log("[Frontend] /api/citation-likelihood/calculate response:",m),!o.ok)throw new Error("Failed to calculate citation likelihood: "+(m.error||o.status));return m}async calculateAccuracy({answer:s,content:t,provider:r,model:n}){console.log("[Frontend] Calling /api/accuracy/calculate with:",{answer:s,content:t,provider:r,model:n});const o=await fetch(`${re}/accuracy/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,provider:r,model:n})});let m;try{m=await o.json()}catch(k){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/calculate:",k),new Error("Failed to parse JSON from /api/accuracy/calculate")}if(console.log("[Frontend] /api/accuracy/calculate response:",m),!o.ok)throw new Error("Failed to calculate accuracy: "+(m.error||o.status));return m}async calculateGeminiAccuracy({answer:s,content:t,model:r}){console.log("[Frontend] Calling /api/accuracy/gemini with:",{answer:s,content:t,model:r});const n=await fetch(`${re}/accuracy/gemini`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,model:r})});let o;try{o=await n.json()}catch(m){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/gemini:",m),new Error("Failed to parse JSON from /api/accuracy/gemini")}if(console.log("[Frontend] /api/accuracy/gemini response:",o),!n.ok)throw new Error("Failed to calculate Gemini accuracy: "+(o.error||n.status));return o}async calculateGeoScoreBackend(s){const t=await fetch(`${re}/geo-score`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(s)});let r;try{r=await t.json()}catch(n){throw console.error("[Frontend] Failed to parse JSON from /api/geo-score:",n),new Error("Failed to parse JSON from /api/geo-score")}if(console.log("[Frontend] /api/geo-score response:",r),!t.ok)throw new Error("Failed to calculate GEO score: "+(r.error||t.status));return r}async getGEOFanoutAnalysis(s){const t=s?`${re}/geo-fanout/analysis?sessionId=${s}`:`${re}/geo-fanout/analysis`;console.log("[Frontend] Calling GEO fanout analysis:",t);const r=await fetch(t,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});let n;try{n=await r.json()}catch(o){throw console.error("[Frontend] Failed to parse JSON from GEO fanout analysis:",o),new Error("Failed to parse JSON from GEO fanout analysis")}if(console.log("[Frontend] GEO fanout analysis response:",n),!r.ok)throw new Error("Failed to get GEO fanout analysis: "+(n.error||r.status));return n}async analyzeCompetitor(s,t){const r=await fetch(`${re}/competitor/analyze`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domain:s,userContent:t})}),n=await r.json();if(!r.ok)throw new Error("Failed to analyze competitor: "+(n.error||r.status));return n}async analyzeMultipleCompetitors(s,t){const r=await fetch(`${re}/competitor/analyze-multiple`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domains:s,userContent:t})}),n=await r.json();if(!r.ok)throw new Error("Failed to analyze competitors: "+(n.error||r.status));return n}async getCompetitorAnalyses(){const s=await fetch(`${re}/competitor/analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),t=await s.json();if(!s.ok)throw new Error("Failed to get competitor analyses: "+(t.error||s.status));return t}async getCompetitorAnalysis(s){const t=await fetch(`${re}/competitor/analysis/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to get competitor analysis: "+(r.error||t.status));return r}async deleteCompetitorAnalysis(s){const t=await fetch(`${re}/competitor/analysis/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to delete competitor analysis: "+(r.error||t.status));return r}async extractContentFromUrl(s){return console.log("[API Service] Extracting content from URL:",s),console.log("[API Service] API_BASE_URL:",re),console.log("[API Service] Access token:",localStorage.getItem("accessToken")?"Present":"Missing"),this.request("/extract-content",{method:"POST",body:JSON.stringify({url:s})})}async crawlWebsite(s,t){return console.log("[API Service] Crawling website:",s,"with options:",t),this.request("/crawl-website",{method:"POST",body:JSON.stringify({url:s,options:t})})}async extractFullPageHtml(s){return console.log("[API Service] Extracting full page HTML from URL:",s),this.request("/extract/fullpage",{method:"POST",body:JSON.stringify({url:s})})}async getSmartAnalyses(){const s=await fetch(`${re}/competitor/smart-analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),t=await s.json();if(!s.ok)throw new Error("Failed to get smart analyses: "+(t.error||s.status));return t}async getSmartAnalysis(s){const t=await fetch(`${re}/competitor/smart-analysis/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to get smart analysis: "+(r.error||t.status));return r}async createSmartAnalysis(s){const t=await fetch(`${re}/competitor/smart-analysis`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(s)}),r=await t.json();if(!t.ok)throw new Error("Failed to create smart analysis: "+(r.error||t.status));return r}async deleteSmartAnalysis(s){const t=await fetch(`${re}/competitor/smart-analysis/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to delete smart analysis: "+(r.error||t.status));return r}async analyzeContentStructure(s,t){return console.log("[API Service] Analyzing content structure for:",t?`URL: ${t}`:`Content length: ${s.length}`),t?(console.log("[API Service] Using dedicated structural content crawler for URL"),this.request("/structural-content/crawl",{method:"POST",body:JSON.stringify({url:t})})):this.request("/content/analyze-structure",{method:"POST",body:JSON.stringify({content:s,url:t})})}async saveLastStructureAnalysis(s){return this.request("/structure/last",{method:"POST",body:JSON.stringify({analysis:s})})}async getLastStructureAnalysis(s){const t=s?`?url=${encodeURIComponent(s)}`:"";return this.request(`/structure/last${t}`,{method:"GET"})}async getGA4PageMetrics(s){return this.request("/analytics/ga4",{method:"POST",body:JSON.stringify(s)})}async getSearchConsoleMetrics(s){return this.request("/analytics/search-console",{method:"POST",body:JSON.stringify(s)})}async getLLMVisibility(s){return this.request("/analytics/llm-visibility",{method:"POST",body:JSON.stringify(s)})}async applyStructureSuggestions(s,t){const r=await fetch(`${re}/content/apply-suggestions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({content:s,suggestions:t})}),n=await r.json();if(!r.ok)throw new Error("Failed to apply structure suggestions: "+(n.error||r.status));return n}async getAIVisibilityAnalysis(s,t,r){const n=new URLSearchParams;t&&n.append("industry",t),r?.fast&&n.append("fast","true");const o=n.toString(),m=o?`?${o}`:"";return this.request(`/ai-visibility/${encodeURIComponent(s)}${m}`,{signal:r?.signal})}async analyzeSingleCompetitor(s,t){return await this.request("/ai-visibility/analyze-competitor",{method:"POST",body:JSON.stringify({companyName:s,industry:t})})}}const xe=new Gt;class Kt{SESSION_PREFIX="kabini_analysis_session_";SESSION_EXPIRY_DAYS=7;MAX_SESSIONS_PER_TYPE=5;saveAnalysisSession(s,t,r,n,o,m,k){const g=this.generateSessionId(s),c=Date.now(),h=c+this.SESSION_EXPIRY_DAYS*24*60*60*1e3,S={id:g,type:s,data:t,timestamp:c,expiresAt:h,userId:k,inputValue:r,analysisType:n,inputType:o,industry:m};return localStorage.setItem(this.SESSION_PREFIX+g,JSON.stringify(S)),this.updateSessionIndex(s,g),this.cleanupOldSessions(s),console.log(`[SessionManager] Saved ${s} session:`,g),g}getLatestAnalysisSession(s,t){const r=this.getSessionIndex(s);if(r.length===0)return null;const n=r[r.length-1],o=localStorage.getItem(this.SESSION_PREFIX+n);if(!o)return null;try{const m=JSON.parse(o);return m.expiresAt<Date.now()?(this.removeSession(m.id),null):t&&m.userId&&m.userId!==t?null:m}catch(m){return console.error("[SessionManager] Error parsing session data:",m),this.removeSession(n),null}}getAllActiveSessions(s){const t=[];return["overview","ai-visibility","content-structure","competitor"].forEach(n=>{this.getSessionIndex(n).forEach(m=>{const k=localStorage.getItem(this.SESSION_PREFIX+m);if(k)try{const g=JSON.parse(k);if(g.expiresAt<Date.now()){this.removeSession(g.id);return}if(s&&g.userId&&g.userId!==s)return;t.push(g)}catch(g){console.error("[SessionManager] Error parsing session data:",g),this.removeSession(m)}})}),t.sort((n,o)=>o.timestamp-n.timestamp)}clearSessionsByType(s){this.getSessionIndex(s).forEach(r=>{this.removeSession(r)}),localStorage.removeItem(`kabini_session_index_${s}`),console.log(`[SessionManager] Cleared all ${s} sessions`)}clearAllSessions(s){this.getAllActiveSessions(s).forEach(n=>{this.removeSession(n.id)}),["overview","ai-visibility","content-structure","competitor"].forEach(n=>{localStorage.removeItem(`kabini_session_index_${n}`)}),console.log("[SessionManager] Cleared all sessions")}removeSession(s){localStorage.removeItem(this.SESSION_PREFIX+s),["overview","ai-visibility","content-structure","competitor"].forEach(r=>{const o=this.getSessionIndex(r).filter(m=>m!==s);this.setSessionIndex(r,o)})}generateSessionId(s){return`${s}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getSessionIndex(s){try{const t=localStorage.getItem(`kabini_session_index_${s}`);return t?JSON.parse(t):[]}catch{return[]}}setSessionIndex(s,t){localStorage.setItem(`kabini_session_index_${s}`,JSON.stringify(t))}updateSessionIndex(s,t){const n=this.getSessionIndex(s).filter(o=>o!==t);n.push(t),n.length>this.MAX_SESSIONS_PER_TYPE&&n.splice(0,n.length-this.MAX_SESSIONS_PER_TYPE),this.setSessionIndex(s,n)}cleanupOldSessions(s){const t=this.getSessionIndex(s),r=Date.now();t.forEach(n=>{const o=localStorage.getItem(this.SESSION_PREFIX+n);if(o)try{const m=JSON.parse(o);m.expiresAt<r&&this.removeSession(m.id)}catch{this.removeSession(n)}})}isSessionValid(s,t){return this.getLatestAnalysisSession(s,t)!==null}getSessionAge(s,t){const r=this.getLatestAnalysisSession(s,t);if(!r)return 0;const o=Date.now()-r.timestamp;return Math.floor(o/(1e3*60*60))}}const ye=new Kt,Qt="llm_qa_sessions",Wt="llm_qa_current_session";function Ze({title:l,icon:s,iconBgColor:t,children:r}){return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l}),e.jsx("div",{className:`w-10 h-10 rounded-full ${t} flex items-center justify-center`,children:s})]}),r]})}function Yt({competitors:l,company:s}){const r=(()=>{if(!l||l.length===0)return{positive:0,neutral:0,negative:0,total:0,drivers:{positive:[],neutral:[],negative:[]}};let m=0,k=0,g=0,c=0;const h=[],S=[],F=[];l.forEach(T=>{const Z=(T.breakdowns||{}).gemini||{},Q=Z.mentionsScore||0,ne=Z.sentimentScore||.5;m+=Q,ne<.3?(c+=Q,F.push(T.name||"Unknown")):ne>.7?(k+=Q,h.push(T.name||"Unknown")):(g+=Q,S.push(T.name||"Unknown"))});let E=m>0?k/m*100:0,P=m>0?g/m*100:0,J=m>0?c/m*100:0;return J===100&&(P=80,J=20,E=0),{positive:Math.round(E*100)/100,neutral:Math.round(P*100)/100,negative:Math.round(J*100)/100,total:m,drivers:{positive:h.slice(0,3),neutral:S.slice(0,3),negative:F.slice(0,3)}}})(),n=r.neutral>r.positive&&r.neutral>r.negative?"Neutral":r.positive>r.negative?"Positive":"Negative",o=n==="Positive"?"text-green-600":n==="Negative"?"text-red-600":"text-yellow-600";return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sentiment Analysis"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:`text-2xl font-bold ${o}`,children:n})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Positive"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${r.positive}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r.positive,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Neutral"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${r.neutral}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r.neutral,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Negative"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${r.negative}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r.negative,"%"]})]})]})]})]})]})}function Xt({score:l,industry:s,metrics:t}){const n=(g=>{const c=Math.max(0,Math.min(10,g));return Math.round(c*10)})(l),o=g=>g>=80?"text-green-600":g>=60?"text-blue-600":g>=40?"text-yellow-600":"text-red-600",m=g=>g>=80?"bg-green-500":g>=60?"bg-blue-500":g>=40?"bg-yellow-500":"bg-red-500",k=g=>g>=80?"Excellent":g>=60?"Good":g>=40?"Fair":"Poor";return e.jsx(Ze,{title:"AI Visibility Score",icon:e.jsx(Qe,{className:"w-5 h-5 text-white"}),iconBgColor:"bg-green-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-4xl font-bold ${o(n)} mb-2`,children:n}),e.jsx("div",{className:"text-gray-600 mb-2",children:"out of 100"}),e.jsx("div",{className:`text-lg font-semibold ${o(n)} mb-3`,children:k(n)}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full ${m(n)} transition-all duration-500`,style:{width:`${Math.min(100,Math.max(0,n))}%`}})})]})})}function Zt({serviceStatus:l,aiScores:s}){const t=[{name:"ChatGPT",key:"chatgpt",icon:e.jsx(Se,{className:"w-4 h-4"})},{name:"Gemini",key:"gemini",icon:e.jsx(Se,{className:"w-4 h-4"})},{name:"Perplexity",key:"perplexity",icon:e.jsx(Se,{className:"w-4 h-4"})},{name:"Claude",key:"claude",icon:e.jsx(Se,{className:"w-4 h-4"})}],n=(()=>{const o={chatgpt:!1,gemini:!1,perplexity:!1,claude:!1};return s&&(o.chatgpt=s.chatgpt!==void 0&&s.chatgpt>0,o.gemini=s.gemini!==void 0&&s.gemini>0,o.perplexity=s.perplexity!==void 0&&s.perplexity>0,o.claude=s.claude!==void 0&&s.claude>0),o})();return t.filter(o=>n[o.key]).length,e.jsx(Ze,{title:"LLM Presence",icon:e.jsx(kt,{className:"w-5 h-5 text-white"}),iconBgColor:"bg-blue-500",children:e.jsx("div",{className:"space-y-3",children:t.map(o=>{const m=n[o.key];return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:o.name}),e.jsx("div",{className:`flex items-center ${m?"text-green-600":"text-red-600"}`,children:m?e.jsxs(e.Fragment,{children:[o.icon,e.jsx("span",{className:"ml-1 text-sm",children:"Available"})]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-1 text-sm",children:"Not Available"})]})})]},o.key)})})})}function es({competitors:l,industry:s}){const r=(n=>{if(!n||n.length===0)return{status:"No Data",rank:"N/A",color:"text-gray-500",score:0,rawScore:0};const o=n.reduce((k,g)=>k+(g.totalScore||0),0)/n.length,m=Math.round(o*10);return m>=80?{status:"Excellent",rank:"Top 10%",color:"text-purple-600",score:m,rawScore:o}:m>=70?{status:"Above Average",rank:"Top 25%",color:"text-blue-600",score:m,rawScore:o}:m>=60?{status:"Average",rank:"Top 50%",color:"text-yellow-600",score:m,rawScore:o}:m>=50?{status:"Below Average",rank:"Bottom 50%",color:"text-orange-600",score:m,rawScore:o}:{status:"Poor",rank:"Bottom 25%",color:"text-red-600",score:m,rawScore:o}})(l);return Math.min(5,Math.max(1,Math.ceil((l?.length||0)/2))),e.jsx(Ze,{title:"Competitor Benchmark",icon:e.jsx(Oe,{className:"w-5 h-5 text-white"}),iconBgColor:"bg-purple-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${r.color} mb-2`,children:r.status}),e.jsxs("div",{className:"text-lg font-semibold text-gray-700 mb-3",children:["Score: ",r.score,"/100"]})]})})}function hs(){const{user:l}=xt(),[s]=Te(Qt,[]);Te(Wt,null),mt();const[t,r]=f.useState(()=>{try{const x=localStorage.getItem("overview_market_analysis");return x&&JSON.parse(x).originalInput||""}catch{return""}}),[n,o]=f.useState("root-domain"),[m,k]=f.useState(!1),[g,c]=f.useState(()=>{try{const x=localStorage.getItem("overview_market_analysis");return x&&JSON.parse(x).inputType||"company"}catch{return"company"}}),[h,S]=f.useState(()=>{try{const x=localStorage.getItem("overview_market_analysis");if(x){const j=JSON.parse(x);return j.data||j}return null}catch{return null}}),[F,E]=f.useState(null),[P,J]=f.useState(!1),[T,U]=f.useState(null),[Z,Q]=f.useState(!1),[ne,te]=f.useState(!1),[v,L]=f.useState(""),[y,b]=f.useState(!1),[C,_]=f.useState(!1),[D,R]=f.useState([]),[w,A]=f.useState(0),[u,z]=f.useState(!1);f.useEffect(()=>{const x=ae.getHistoryItems();R(x),console.log("[Overview] Loaded history items:",x.length)},[w]),f.useEffect(()=>{const x=ye.getLatestAnalysisSession("overview",l?.id);x?(r(x.inputValue||""),c(x.inputType||"company"),S(x.data),console.log("[Overview] Restored analysis session:",x)):console.log("[Overview] No previous analysis session found - starting fresh")},[l?.id]);const[K,B]=f.useState(!1);f.useEffect(()=>{const x=ye.getLatestAnalysisSession("overview",l?.id);B(!x)},[l?.id]),f.useEffect(()=>{const x=d=>{(d.key==="comprehensive_history"||d.key==="sessions")&&(console.log("[Overview] Storage changed, refreshing data"),A(G=>G+1))};window.addEventListener("storage",x);const j=setInterval(()=>{ae.getHistoryItems().length!==D.length&&(console.log("[Overview] Item count changed, refreshing data"),A(G=>G+1))},3e3);return()=>{window.removeEventListener("storage",x),clearInterval(j)}},[D.length]),f.useEffect(()=>{const x=j=>{j.target.closest(".dropdown-container")||Q(!1)};return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[]),l&&s.filter(x=>x.userId===l.id);const M=x=>{try{const d=x.replace(/^https?:\/\//,"").replace(/^www\./,"").split("/"),G=d[0];return d.length===1||d.length>1&&d[1].trim()===""?"root-domain":"exact-url"}catch(j){return console.error("Error detecting URL type:",j),"root-domain"}},W=x=>{try{let j=x.replace(/^https?:\/\//,"").replace(/^www\./,"");j=j.split("/")[0].split("?")[0].split("#")[0];const d=j.split(".");return d.length>=2?d[d.length-2]:j}catch(j){return console.error("Error extracting company from URL:",j),x}},ee=(x,j)=>{const d=x.toLowerCase();return j?.toLowerCase(),d.includes("cloud")&&(d.includes("migration")||d.includes("migrate")||d.includes("transform"))?"Cloud Migration & Transformation":d.includes("cloud")||d.includes("aws")||d.includes("azure")||d.includes("gcp")||d.includes("kubernetes")||d.includes("docker")||d.includes("devops")?"Cloud Computing & DevOps":d.includes("ai")||d.includes("artificial intelligence")||d.includes("machine learning")||d.includes("ml")||d.includes("deep learning")||d.includes("neural")?"Artificial Intelligence & ML":d.includes("cyber")||d.includes("security")||d.includes("firewall")||d.includes("vpn")||d.includes("threat")||d.includes("protection")?"Cybersecurity":d.includes("data")&&(d.includes("analytics")||d.includes("warehouse")||d.includes("lake")||d.includes("science")||d.includes("mining"))?"Data Analytics & Science":d.includes("saas")||d.includes("software as a service")||d.includes("platform")||d.includes("api")||d.includes("integration")?"SaaS & Platform Services":d.includes("tech")||d.includes("software")||d.includes("digital")||d.includes("innovation")?"Technology & Software":d.includes("bank")||d.includes("finance")||d.includes("credit")||d.includes("loan")||d.includes("payment")||d.includes("fintech")||d.includes("investment")?"Financial Services & Fintech":d.includes("health")||d.includes("medical")||d.includes("pharma")||d.includes("care")||d.includes("biotech")||d.includes("telehealth")?"Healthcare & Biotech":d.includes("retail")||d.includes("shop")||d.includes("store")||d.includes("commerce")||d.includes("ecommerce")||d.includes("marketplace")?"Retail & E-commerce":d.includes("edu")||d.includes("school")||d.includes("university")||d.includes("college")||d.includes("learning")||d.includes("training")?"Education & Training":d.includes("media")||d.includes("news")||d.includes("entertainment")||d.includes("tv")||d.includes("content")||d.includes("publishing")?"Media & Entertainment":d.includes("auto")||d.includes("car")||d.includes("vehicle")||d.includes("transport")||d.includes("logistics")||d.includes("supply chain")?"Automotive & Transportation":d.includes("food")||d.includes("restaurant")||d.includes("cafe")||d.includes("dining")||d.includes("delivery")||d.includes("catering")?"Food & Beverage":d.includes("real")||d.includes("estate")||d.includes("property")||d.includes("housing")||d.includes("construction")||d.includes("architecture")?"Real Estate & Construction":d.includes("energy")||d.includes("oil")||d.includes("gas")||d.includes("power")||d.includes("renewable")||d.includes("solar")||d.includes("wind")?"Energy & Utilities":d.includes("consulting")||d.includes("consultant")||d.includes("advisory")||d.includes("strategy")||d.includes("management")?"Consulting & Advisory":"Business Services"},oe=async()=>{if(!t.trim()){E("Please enter a company name or URL to analyze.");return}let x=t.trim(),j="company";(t.includes("http://")||t.includes("https://")||t.includes("www."))&&(x=W(t),j="url",console.log("[Overview] Detected URL, extracted company name:",x));const d=ee(x,t);console.log("[Overview] Detected industry:",d),k(!0),E(null),J(!1);try{const G=new AbortController;U(G),console.log("[Overview] Starting AI visibility analysis for:",x),console.log("[Overview] Detected industry:",d);const q=await xe.getAIVisibilityAnalysis(x,d,{signal:G.signal});if(console.log("[Overview] Analysis results received:",q),q.success&&q.data){console.log("[Overview] Setting analysis result:",q.data);const ie={...q.data,industry:d,originalInput:t,inputType:j,analysisType:n};S(ie),J(!0);try{const se=q.data.competitors||[],le={id:`ai-visibility-${Date.now()}`,type:"ai-visibility",name:`AI Visibility Analysis - ${x}`,timestamp:new Date().toISOString(),status:"completed",company:x,industry:d,analysis:{competitors:se.map(X=>({name:X.name,mentions:X.mentions||0,status:"success"})),serviceStatus:q.data.serviceStatus||{gemini:!0,perplexity:!0,claude:!0,chatgpt:!0},summary:{totalCompetitors:se.length,averageVisibilityScore:se.reduce((X,ce)=>X+(ce.mentions||0),0)/Math.max(se.length,1),topCompetitor:se.length>0?se.reduce((X,ce)=>(ce.mentions||0)>(X.mentions||0)?ce:X).name:"None"}}};try{await ae.addHistoryItem(le),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}})),console.log("[Overview] Analysis saved to history:",le)}catch(X){console.error("[Overview] Failed to save analysis to history:",X),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}}))}}catch(se){console.warn("Failed to save analysis to history:",se)}try{localStorage.setItem("overview_market_analysis",JSON.stringify({company:x,originalInput:t,inputType:j,industry:d,analysisType:n,data:ie,timestamp:Date.now()}))}catch(se){console.warn("Failed to cache analysis results:",se)}}else console.error("[Overview] Analysis failed:",q.error),E(q.error||"Analysis failed. Please try again.")}catch(G){if(G.name==="AbortError"){console.log("Analysis was cancelled");return}console.error("AI analysis error:",G),E(G.message||"Analysis failed. Please try again.")}finally{k(!1),U(null)}},Ee=x=>{if(x?.aiVisibilityScore!==void 0&&x?.aiVisibilityScore!==null)return x.aiVisibilityScore;if(x?.totalScore!==void 0&&x?.totalScore!==null)return x.totalScore;if(x?.visibilityScore!==void 0&&x?.visibilityScore!==null)return x.visibilityScore;if(x?.competitors&&x.competitors.length>0){const j=x.competitors.find(G=>G.name?.toLowerCase()===x.company?.toLowerCase());if(j?.totalScore!==void 0&&j?.totalScore!==null)return j.totalScore;const d=x.competitors.filter(G=>G.totalScore!==void 0&&G.totalScore!==null).map(G=>G.totalScore);if(d.length>0)return d.reduce((q,ie)=>q+ie,0)/d.length}return 0},he=x=>{if(!x?.competitors||x.competitors.length===0)return null;const j=x.competitors.find(X=>X.name?.toLowerCase()===x.company?.toLowerCase());if(!j)return null;const d=j.totalScore||0,G=j.aiScores||{},q=j.breakdowns||{},ie=Object.values(G).filter(X=>typeof X=="number"),se=ie.length>0?ie.reduce((X,ce)=>X+ce,0)/ie.length:0,le=q.gemini||{};return{aiVisibilityScore:Math.min(10,Math.max(0,d)),brandMentions:Number((le.mentionsScore||0).toFixed(5)),medianCompetitorMentions:Number((Math.round(se*10)/10).toFixed(5)),shareOfVoice:Number((Math.round(d/10*100*100)/100).toFixed(5)),averagePosition:Number((le.positionScore||0).toFixed(5)),searchVolume:"N/A",sentiment:le.sentimentScore>.5?"Positive":le.sentimentScore<.3?"Negative":"Neutral",platformBreakdown:G,totalMentions:Number((le.mentionsScore||0).toFixed(5))}},pe=x=>x>=2.5?"bg-green-500":x>=1.5?"bg-yellow-500":"bg-red-500",ue=x=>x>=2.5?"text-green-600 font-semibold":x>=1.5?"text-yellow-600 font-semibold":"text-red-600 font-semibold",ge=x=>x.toFixed(4),me=x=>{const j=h?.competitors?.[x]?.name;if(window.confirm(`Are you sure you want to remove "${j}" from the analysis?`)){const d=h?.competitors?.filter((G,q)=>q!==x)||[];S({...h,competitors:d})}};return e.jsxs("div",{className:"w-full max-w-full mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:["Welcome ",l?.displayName?.split(" ")[0]||l?.name?.split(" ")[0]||"User"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Welcome to kabini.ai - Your AI-Powered Content Enhancement Platform"})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 sm:p-6 lg:p-8 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Website Analysis Dashboard"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Enter your website URL or company name to get instant AI visibility insights and market positioning."})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-stretch gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex",children:e.jsx("input",{type:"text",value:t,onChange:x=>We(x,j=>{if(r(j),j.includes("http://")||j.includes("https://")||j.includes("www.")){const d=M(j);o(d),console.log("[Overview] Auto-detected URL type:",d)}}),onPaste:x=>Ye(x,j=>{if(r(j),j.includes("http://")||j.includes("https://")||j.includes("www.")){const d=M(j);o(d),console.log("[Overview] Auto-detected URL type (pasted):",d)}}),onKeyDown:Xe,onKeyPress:x=>{x.key==="Enter"&&!m&&t.trim()&&oe()},required:!0,placeholder:"Enter company name or URL",className:"flex-1 px-4 py-4 border-2 border-blue-600 rounded-l-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg h-[60px]",disabled:m})})}),e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-stretch",children:[e.jsx("button",{onClick:oe,disabled:m||!t.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-8 py-4 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors shadow-lg w-full lg:w-auto min-w-[140px] h-[60px]",children:m?e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-5 h-5"}),"Analyze Now"]})}),m&&e.jsx("button",{onClick:()=>{try{T?.abort()}catch{}k(!1)},className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors w-full lg:w-auto min-w-[120px] h-[60px]",children:"Stop"})]})]}),F&&e.jsx("div",{className:"mb-6 text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-3",children:F}),P&&e.jsx("div",{className:"mb-6 text-green-700 bg-green-50 border border-green-200 rounded-lg px-4 py-3",children:"✅ Analysis completed successfully! Results are ready below."}),h&&e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Overview"})}),h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 lg:gap-6 mb-6 lg:mb-8",children:[e.jsx(Xt,{score:Ee(h),industry:h?.industry,metrics:he(h)}),e.jsx(Zt,{serviceStatus:h?.serviceStatus,aiScores:h?.competitors?.[0]?.aiScores}),e.jsx(es,{competitors:h?.competitors||[],industry:h?.industry}),e.jsx(Yt,{competitors:h?.competitors||[],company:h?.company})]}),e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Competitor Analysis"})}),h.competitors&&h.competitors.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Competitor Performance Overview"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visual comparison of average AI visibility scores across competitors"})]}),e.jsx("div",{className:"h-48 sm:h-56 lg:h-64 flex items-end justify-between space-x-1 sm:space-x-2",children:h.competitors.map((x,j)=>{const d=x.totalScore||0,G=Math.min(100,Math.max(5,d/10*100)),q=pe(d);return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full max-w-12 sm:max-w-16 bg-gray-200 rounded-t-lg relative",children:e.jsx("div",{className:`${q} rounded-t-lg transition-all duration-500 ease-out`,style:{height:`${G}%`,minHeight:"20px"},children:e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 text-xs font-medium text-gray-700 whitespace-nowrap",children:ge(d)})})}),e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center font-medium truncate w-full",children:x.name})]},j)})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"inline-flex items-center flex-wrap justify-center gap-2 sm:gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded mr-1"}),e.jsx("span",{children:"Excellent (8-10)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded mr-1"}),e.jsx("span",{children:"Good (6-7.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded mr-1"}),e.jsx("span",{children:"Fair (4-5.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded mr-1"}),e.jsx("span",{children:"Poor (0-3.9)"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Competitors Comparison"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed scoring breakdown for each company across multiple models"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gemini"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perplexity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Claude"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ChatGPT"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Average Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.competitors.map((x,j)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-black",children:x.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${pe(x.aiScores.gemini)}`,children:ge(x.aiScores.gemini)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${pe(x.aiScores.perplexity)}`,children:ge(x.aiScores.perplexity)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${pe(x.aiScores.claude)}`,children:ge(x.aiScores.claude)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${pe(x.aiScores.chatgpt)}`,children:ge(x.aiScores.chatgpt)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm font-semibold ${ue(x.totalScore)}`,children:ge(x.totalScore)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>me(j),className:"text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 p-2 rounded-full transition-colors",title:"Delete competitor",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},j))})]})})]})]})]})]})}const ts=({data:l})=>{console.log("[AIVisibilityTable] Rendering with data:",l);const[s,t]=f.useState(!1),[r,n]=f.useState(""),[o,m]=f.useState(l.competitors||[]),[k,g]=f.useState(!1),[c,h]=f.useState(""),[S,F]=f.useState(!1),[E,P]=f.useState(!1),[J,T]=f.useState("");f.useEffect(()=>{if(!l||!l.competitors){console.error("[AIVisibilityTable] Invalid data structure:",l),t(!0),n("Invalid data structure received");return}if(!Array.isArray(l.competitors)){console.error("[AIVisibilityTable] Competitors is not an array:",l.competitors),t(!0),n("Competitors data is not in expected format");return}t(!1),n(""),console.log("[AIVisibilityTable] Data validation passed, competitors count:",l.competitors.length)},[l]);const U=v=>{const L=o[v].name;if(window.confirm(`Are you sure you want to remove "${L}" from the analysis?`)){const y=o.filter((b,C)=>C!==v);m(y)}},Z=async()=>{if(!c.trim()){alert("Please enter a competitor name");return}if(o.some(v=>v.name.toLowerCase()===c.toLowerCase())){alert("This competitor is already in the analysis");return}console.log("[AIVisibilityTable] Adding competitor:",c),console.log("[AIVisibilityTable] Current industry:",l.industry),P(!0);try{const v=await xe.analyzeSingleCompetitor(c,l.industry);console.log("[AIVisibilityTable] API response received:",v);let L;if(v&&v.success&&v.data)L=v.data,console.log("[AIVisibilityTable] Extracted competitor data:",L);else if(v&&v.name)L=v,console.log("[AIVisibilityTable] Using direct competitor data:",L);else throw new Error("Invalid response format from API");if(!L||!L.name)throw new Error("Invalid competitor data received from API");const y=[...o,L];console.log("[AIVisibilityTable] Updated competitors list:",y),m(y),h(""),g(!1),T(`${c} has been added successfully!`),setTimeout(()=>T(""),3e3)}catch(v){console.error("Error adding competitor:",v),alert(`Failed to add competitor: ${v.message}`)}finally{P(!1)}},Q=v=>v>=2.5?"text-green-600 bg-green-100":v>=1.5?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",ne=v=>v>=2.5?"text-green-600 font-semibold":v>=1.5?"text-yellow-600 font-semibold":"text-red-600 font-semibold",te=v=>v.toFixed(4);return s?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error Loading Competitor Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:r}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-sm text-red-600 hover:text-red-500 underline",children:"Reload page"})]})]})}):e.jsxs("div",{className:"space-y-6 w-full max-w-full overflow-hidden",children:[o.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Competitor Performance Overview"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visual comparison of average AI visibility scores across competitors"})]}),e.jsx("div",{className:"h-48 sm:h-56 lg:h-64 flex items-end justify-between space-x-1 sm:space-x-2",children:o.map((v,L)=>{const y=v.totalScore||0,b=Math.min(100,Math.max(5,y/10*100)),C=Q(y);return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full max-w-12 sm:max-w-16 bg-gray-200 rounded-t-lg relative",children:e.jsx("div",{className:`${C} rounded-t-lg transition-all duration-500 ease-out`,style:{height:`${b}%`,minHeight:"20px"},children:e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 text-xs font-medium text-gray-700 whitespace-nowrap",children:te(y)})})}),e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center font-medium truncate w-full",children:v.name})]},L)})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"inline-flex items-center flex-wrap justify-center gap-2 sm:gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded mr-1"}),e.jsx("span",{children:"Excellent (8-10)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded mr-1"}),e.jsx("span",{children:"Good (6-7.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded mr-1"}),e.jsx("span",{children:"Fair (4-5.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded mr-1"}),e.jsx("span",{children:"Poor (0-3.9)"})]})]})})]}),J&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-green-800",children:J})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Competitor"}),e.jsx("button",{onClick:()=>g(!k),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black",children:k?"Cancel":"Add Competitor"})]}),k&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-end space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"competitor-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Competitor Company Name"}),e.jsx("input",{type:"text",id:"competitor-name",value:c,onChange:v=>{const L=v.target.value.trim(),y=/^(https?:\/\/)?[^\s]+\.[^\s]+/i.test(L);if(F(y),y)h(L);else{const b=L.replace(/[^A-Za-z]/g,"");h(b)}try{v.target.setCustomValidity("")}catch{}},onKeyPress:v=>{v.key==="Enter"&&!E&&c.trim()&&Z()},placeholder:"Enter competitor company name or paste a URL...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-gray-900 placeholder-gray-400 bg-white",onInvalid:v=>{v.preventDefault();const L=S?"Please enter a valid URL (e.g., https://example.com)":"Only letters (A–Z, a–z) are allowed";v.target.setCustomValidity(L)},onBlur:v=>{const L=v.currentTarget.value.trim();if(!L){v.currentTarget.setCustomValidity("");return}if(S){const y=/^(https?:\/\/)?([A-Za-z0-9-]+\.)+[A-Za-z]{2,}(\/[^\s]*)?$/i.test(L);v.currentTarget.setCustomValidity(y?"":"Please enter a valid URL (e.g., https://example.com)")}else{const y=/^[A-Za-z]+$/.test(L);v.currentTarget.setCustomValidity(y?"":"Only letters (A–Z, a–z) are allowed")}},disabled:E})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{onClick:Z,disabled:E||!c.trim(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black disabled:opacity-50 disabled:cursor-not-allowed",children:E?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing..."]}):"Add & Analyze"})})]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["The system will automatically analyze AI visibility scores for the new competitor.",E&&e.jsxs("span",{className:"text-black font-medium",children:[" ","This may take 30-60 seconds as we analyze across 4 AI engines."]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Market Analysis Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed scoring breakdown for each company across multiple models"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gemini"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perplexity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Claude"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ChatGPT"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Average Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map((v,L)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-black",children:v.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:v.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Q(v.aiScores.gemini)}`,children:te(v.aiScores.gemini)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Q(v.aiScores.perplexity)}`,children:te(v.aiScores.perplexity)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Q(v.aiScores.claude)}`,children:te(v.aiScores.claude)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Q(v.aiScores.chatgpt)}`,children:te(v.aiScores.chatgpt)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm font-semibold ${ne(v.totalScore)}`,children:te(v.totalScore)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>U(L),className:"text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 p-2 rounded-full transition-colors",title:"Delete competitor",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},L))})]})})]}),o.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Competitor Snapshot"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Holistic view of your site versus competitors across multiple dimensions"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6 mb-6 lg:mb-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2",children:"Traffic Metrics"}),e.jsx("div",{className:"space-y-3",children:o.map((v,L)=>{const y=Math.floor((v.totalScore||0)*1e4)+Math.floor(Math.random()*5e4),b=Math.floor(y*.8),C=(2+(v.totalScore||0)*.3).toFixed(1),_=Math.floor((v.totalScore||0)*60)+30,D=Math.max(20,80-(v.totalScore||0)*5);return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:v.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Competitor ",L+1]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Est. Visits:"}),e.jsx("span",{className:"ml-2 font-medium",children:y.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Unique Visitors:"}),e.jsx("span",{className:"ml-2 font-medium",children:b.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pages/Visit:"}),e.jsx("span",{className:"ml-2 font-medium",children:C})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Avg Duration:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[_,"s"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-600",children:"Bounce Rate:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[D,"%"]})]})]})]},L)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2",children:"Market Positioning & Growth"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Growth Quadrant Analysis"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Positioning based on Traffic vs Growth"})]}),e.jsxs("div",{className:"relative h-64 bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"absolute top-1/2 left-0 w-full h-px bg-gray-300"}),e.jsx("div",{className:"absolute left-1/2 top-0 w-px h-full bg-gray-300"}),e.jsx("div",{className:"absolute top-4 left-4 text-xs font-medium text-gray-700",children:"Game Changers"}),e.jsx("div",{className:"absolute top-4 right-4 text-xs font-medium text-gray-700",children:"Leaders"}),e.jsx("div",{className:"absolute bottom-4 left-4 text-xs font-medium text-gray-700",children:"Niche Players"}),e.jsx("div",{className:"absolute bottom-4 right-4 text-xs font-medium text-gray-700",children:"Established Players"}),o.map((v,L)=>{const y=(v.totalScore||0)*10,b=Math.floor(Math.random()*100),C=Math.min(85,Math.max(15,y)),_=Math.min(85,Math.max(15,100-b));return e.jsx("div",{className:"absolute w-3 h-3 bg-black rounded-full border-2 border-white shadow-lg",style:{left:`${C}%`,top:`${_}%`},title:`${v.name}: Traffic ${Math.round(y)}, Growth ${b}%`},L)})]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4",children:"Channel Mix & Engagement"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4",children:o.map((v,L)=>{const y=Math.floor((v.totalScore||0)*10)+30,b=Math.floor(Math.random()*20)+5,C=Math.floor(Math.random()*15)+5,_=100-y-b-C;return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:v.name}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Organic:"}),e.jsxs("span",{className:"font-medium",children:[y,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${y}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Paid:"}),e.jsxs("span",{className:"font-medium",children:[b,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${b}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Referral:"}),e.jsxs("span",{className:"font-medium",children:[C,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${C}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Direct:"}),e.jsxs("span",{className:"font-medium",children:[_,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full",style:{width:`${_}%`}})})]})]},L)})})]}),e.jsxs("div",{className:"mb-6 lg:mb-8",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4",children:"Competition Level & Keyword Overlap"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:"Competition Level Ranking"}),e.jsx("div",{className:"space-y-3",children:o.map((v,L)=>{const y=Math.floor((v.totalScore||0)*10)+Math.floor(Math.random()*30),b=Math.floor(y*10)+Math.floor(Math.random()*100);return e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-black",children:L+1})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:v.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[b," shared keywords"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-black",children:y}),e.jsx("div",{className:"text-xs text-gray-500",children:"Competition Score"})]})]},L)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:"Keyword Gap Analysis"}),e.jsx("div",{className:"space-y-3",children:o.map((v,L)=>{const y=Math.floor(Math.random()*200)+50,b=Math.floor((v.totalScore||0)*10)+Math.floor(Math.random()*20);return e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:v.name}),e.jsx("span",{className:"text-xs text-gray-500",children:"Opportunity"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Missing Keywords:"}),e.jsx("span",{className:"font-medium",children:y})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${b}%`}})}),e.jsxs("div",{className:"text-right text-xs text-gray-500",children:[b,"% opportunity score"]})]})]},L)})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4",children:"Backlink Profile Comparison"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:o.map((v,L)=>{const y=Math.floor((v.totalScore||0)*1e3)+Math.floor(Math.random()*5e3),b=Math.floor(y*.3)+Math.floor(Math.random()*200),C=Math.floor(y*.8),_=y-C;return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:v.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Backlinks:"}),e.jsx("span",{className:"ml-2 font-medium",children:y.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Referring Domains:"}),e.jsx("span",{className:"ml-2 font-medium",children:b.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Dofollow:"}),e.jsx("span",{className:"ml-2 font-medium",children:C.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Nofollow:"}),e.jsx("span",{className:"ml-2 font-medium",children:_.toLocaleString()})]})]})]},L)})})]})]})]})},ss="llm_qa_sessions",rs="llm_qa_current_session";function ps(){const{user:l}=xt(),[s]=Te(ss,[]);Te(rs,null),mt();const[t,r]=f.useState(()=>{try{return ye.getLatestAnalysisSession("ai-visibility",l?.id)?.inputValue||""}catch{return""}}),[n,o]=f.useState("root-domain"),[m,k]=f.useState(!1),[g,c]=f.useState(()=>{try{return ye.getLatestAnalysisSession("ai-visibility",l?.id)?.inputType||"company"}catch{return"company"}}),[h,S]=f.useState(()=>{try{return ye.getLatestAnalysisSession("ai-visibility",l?.id)?.data||null}catch{return null}}),[F,E]=f.useState(null),[P,J]=f.useState(!1),[T,U]=f.useState(null),[Z,Q]=f.useState(!1),[ne,te]=f.useState([]),[v,L]=f.useState(0),[y,b]=f.useState(!1);f.useEffect(()=>{const w=ae.getHistoryItems();te(w),console.log("[Overview] Loaded history items:",w.length)},[v]),f.useEffect(()=>{try{const w=ye.getLatestAnalysisSession("ai-visibility",l?.id);w&&(console.log("[AIVisibilityAnalysis] Restoring cached analysis data:",w),w.inputValue&&r(w.inputValue),w.inputType&&c(w.inputType),w.analysisType&&o(w.analysisType),w.data&&(S(w.data),J(!0)),console.log("[AIVisibilityAnalysis] Cached data restored successfully"))}catch(w){console.error("[AIVisibilityAnalysis] Error restoring cached data:",w)}},[l?.id]),f.useEffect(()=>{const w=u=>{(u.key==="comprehensive_history"||u.key==="sessions")&&(console.log("[Overview] Storage changed, refreshing data"),L(z=>z+1))};window.addEventListener("storage",w);const A=setInterval(()=>{ae.getHistoryItems().length!==ne.length&&(console.log("[Overview] Item count changed, refreshing data"),L(z=>z+1))},3e3);return()=>{window.removeEventListener("storage",w),clearInterval(A)}},[ne.length]),f.useEffect(()=>{console.log("[AIVisibilityAnalysis] Analysis result changed:",h)},[h]),f.useEffect(()=>{const w=A=>{A.target.closest(".dropdown-container")||Q(!1)};return document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[]),l&&s.filter(w=>w.userId===l.id);const C=w=>{try{const u=w.replace(/^https?:\/\//,"").replace(/^www\./,"").split("/"),z=u[0];return u.length===1||u.length>1&&u[1].trim()===""?"root-domain":"exact-url"}catch(A){return console.error("Error detecting URL type:",A),"root-domain"}},_=w=>{try{let A=w.replace(/^https?:\/\//,"").replace(/^www\./,"");A=A.split("/")[0].split("?")[0].split("#")[0];const u=A.split(".");return u.length>=2?u[u.length-2]:A}catch(A){return console.error("Error extracting company from URL:",A),w}},D=(w,A)=>{const u=w.toLowerCase();return A?.toLowerCase(),u.includes("cloud")&&(u.includes("migration")||u.includes("migrate")||u.includes("transform"))?"Cloud Migration & Transformation":u.includes("cloud")||u.includes("aws")||u.includes("azure")||u.includes("gcp")||u.includes("kubernetes")||u.includes("docker")||u.includes("devops")?"Cloud Computing & DevOps":u.includes("ai")||u.includes("artificial intelligence")||u.includes("machine learning")||u.includes("ml")||u.includes("deep learning")||u.includes("neural")?"Artificial Intelligence & ML":u.includes("cyber")||u.includes("security")||u.includes("firewall")||u.includes("vpn")||u.includes("threat")||u.includes("protection")?"Cybersecurity":u.includes("data")&&(u.includes("analytics")||u.includes("warehouse")||u.includes("lake")||u.includes("science")||u.includes("mining"))?"Data Analytics & Science":u.includes("saas")||u.includes("software as a service")||u.includes("platform")||u.includes("api")||u.includes("integration")?"SaaS & Platform Services":u.includes("tech")||u.includes("software")||u.includes("digital")||u.includes("innovation")?"Technology & Software":u.includes("bank")||u.includes("finance")||u.includes("credit")||u.includes("loan")||u.includes("payment")||u.includes("fintech")||u.includes("investment")?"Financial Services & Fintech":u.includes("health")||u.includes("medical")||u.includes("pharma")||u.includes("care")||u.includes("biotech")||u.includes("telehealth")?"Healthcare & Biotech":u.includes("retail")||u.includes("shop")||u.includes("store")||u.includes("commerce")||u.includes("ecommerce")||u.includes("marketplace")?"Retail & E-commerce":u.includes("edu")||u.includes("school")||u.includes("university")||u.includes("college")||u.includes("learning")||u.includes("training")?"Education & Training":u.includes("media")||u.includes("news")||u.includes("entertainment")||u.includes("tv")||u.includes("content")||u.includes("publishing")?"Media & Entertainment":u.includes("auto")||u.includes("car")||u.includes("vehicle")||u.includes("transport")||u.includes("logistics")||u.includes("supply chain")?"Automotive & Transportation":u.includes("food")||u.includes("restaurant")||u.includes("cafe")||u.includes("dining")||u.includes("delivery")||u.includes("catering")?"Food & Beverage":u.includes("real")||u.includes("estate")||u.includes("property")||u.includes("housing")||u.includes("construction")||u.includes("architecture")?"Real Estate & Construction":u.includes("energy")||u.includes("oil")||u.includes("gas")||u.includes("power")||u.includes("renewable")||u.includes("solar")||u.includes("wind")?"Energy & Utilities":u.includes("consulting")||u.includes("consultant")||u.includes("advisory")||u.includes("strategy")||u.includes("management")?"Consulting & Advisory":"Business Services"},R=async()=>{if(!t.trim()){E("Please enter a company name or URL to analyze.");return}let w=t.trim(),A="company";(t.includes("http://")||t.includes("https://")||t.includes("www."))&&(w=_(t),A="url",console.log("[Overview] Detected URL, extracted company name:",w));const u=D(w,t);console.log("[Overview] Detected industry:",u),k(!0),E(null),J(!1);try{const z=new AbortController;U(z),console.log("[CompetitorInsight] Starting competitor analysis for:",w),console.log("[CompetitorInsight] Detected industry:",u),console.log("[CompetitorInsight] API call parameters:",{finalCompanyName:w,detectedIndustry:u});const K=await xe.getAIVisibilityAnalysis(w,u,{signal:z.signal});if(console.log("[AIVisibilityAnalysis] Analysis results received:",K),K.success&&K.data){console.log("[CompetitorInsight] Setting analysis result:",K.data);const B={...K.data,industry:u,originalInput:t,inputType:A,analysisType:n};S(null),setTimeout(()=>{S(B),J(!0),console.log("[CompetitorInsight] State updated, analysis result set:",B),L(M=>M+1)},100);try{const M=K.data.competitors||[],W={id:`ai-visibility-${Date.now()}`,type:"ai-visibility",name:`Competitor Analysis - ${w}`,timestamp:new Date().toISOString(),status:"completed",company:w,industry:u,analysis:{competitors:M.map(ee=>({name:ee.name,mentions:ee.mentions||0,status:"success"})),serviceStatus:K.data.serviceStatus||{gemini:!0,perplexity:!0,claude:!0,chatgpt:!0},summary:{totalCompetitors:M.length,averageVisibilityScore:M.reduce((ee,oe)=>ee+(oe.mentions||0),0)/Math.max(M.length,1),topCompetitor:M.length>0?M.reduce((ee,oe)=>(oe.mentions||0)>(ee.mentions||0)?oe:ee).name:"None"}}};try{await ae.addHistoryItem(W),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}})),console.log("[CompetitorInsight] Analysis saved to history:",W)}catch(ee){console.error("[CompetitorInsight] Failed to save analysis to history:",ee),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}}))}}catch(M){console.warn("Failed to save analysis to history:",M)}try{ye.saveAnalysisSession("ai-visibility",B,t,n,A,u,l?.id)}catch(M){console.warn("Failed to cache analysis results:",M)}}else console.error("[Overview] Analysis failed:",K.error),E(K.error||"Analysis failed. Please try again.")}catch(z){if(z.name==="AbortError"){console.log("Analysis was cancelled");return}console.error("AI analysis error:",z),E(z.message||"Analysis failed. Please try again.")}finally{k(!1),U(null)}};return e.jsxs("div",{className:"w-full max-w-full mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:["Welcome ",l?.displayName?.split(" ")[0]||l?.name?.split(" ")[0]||"User"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Deep competitive analysis and market intelligence platform"})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 sm:p-6 lg:p-8 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Competitor Analysis Dashboard"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Enter your website URL or company name to get instant competitor insights and market positioning."})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-stretch gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex",children:e.jsx("input",{type:"text",value:t,onChange:w=>We(w,A=>{if(r(A),A.includes("http://")||A.includes("https://")||A.includes("www.")){const u=C(A);o(u),console.log("[Overview] Auto-detected URL type:",u)}}),onPaste:w=>Ye(w,A=>{if(r(A),A.includes("http://")||A.includes("https://")||A.includes("www.")){const u=C(A);o(u),console.log("[Overview] Auto-detected URL type (pasted):",u)}}),onKeyDown:Xe,onKeyPress:w=>{w.key==="Enter"&&!m&&t.trim()&&R()},required:!0,placeholder:"Enter company name or URL",className:"flex-1 px-4 py-4 border-2 border-blue-600 rounded-xl text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg h-[60px]",disabled:m})})}),e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-stretch",children:[e.jsx("button",{onClick:R,disabled:m||!t.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-8 py-4 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors shadow-lg w-full lg:w-auto min-w-[140px] h-[60px]",children:m?e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-5 h-5"}),"Analyze Now"]})}),m&&e.jsx("button",{onClick:()=>{try{T?.abort()}catch{}k(!1)},className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors w-full lg:w-auto min-w-[120px] h-[60px]",children:"Stop"})]})]}),F&&e.jsx("div",{className:"mb-6 text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-3",children:F}),P&&e.jsx("div",{className:"mb-6 text-green-700 bg-green-50 border border-green-200 rounded-lg px-4 py-3",children:"✅ Analysis completed successfully! Results are ready below."}),h&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Competitor Analysis"}),h.competitors&&Array.isArray(h.competitors)&&h.competitors.length>0?e.jsx(ts,{data:h},`analysis-${v}`):e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 8a2 2 0 011.414-1.414l4 4a2 2 0 010 2.828l-4 4a2 2 0 01-2.828 0l-4-4a2 2 0 010-2.828l4-4A2 2 0 018 8z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-black",children:"Competitor Analysis Complete"}),e.jsxs("p",{className:"text-sm text-black mt-1",children:["Your competitor analysis has been completed successfully.",h.competitors&&h.competitors.length>0?` Found ${h.competitors.length} competitors for analysis.`:" No competitors found for this analysis."]})]})]})})]})})]})]})}class as{async analyzeContentStructure(s,t){try{console.log("[ContentStructureService] Calling API with:",{contentLength:s.length,url:t});const r=await xe.analyzeContentStructure(s,t);if(console.log("[ContentStructureService] Raw API response:",r),console.log("[ContentStructureService] Response type:",typeof r),console.log("[ContentStructureService] Response keys:",r?Object.keys(r):"No response"),r&&r.success&&r.analysis)return console.log("[ContentStructureService] Using response.analysis (success case)"),r.analysis;if(r&&r.analysis)return console.log("[ContentStructureService] Using response.analysis (no success field)"),r.analysis;throw r&&!r.success?(console.error("[ContentStructureService] API returned error:",r.error),new Error(r.error||"Analysis failed")):(console.error("[ContentStructureService] Invalid response format:",r),new Error("Invalid response format from server"))}catch(r){throw console.error("[ContentStructureService] Error analyzing content structure:",r),r}}async applyStructureSuggestions(s,t){try{const r=await xe.applyStructureSuggestions(s,t);if(r.success)return r.improvedContent;throw new Error(r.error||"Failed to apply suggestions")}catch(r){return console.error("Error applying structure suggestions:",r),s}}}const dt=new as,ns=({message:l,onClose:s,autoClose:t=!0,autoCloseDelay:r=3e3})=>{const[n,o]=f.useState(!1);return f.useEffect(()=>{if(l){if(o(!0),t){const m=setTimeout(()=>{o(!1),setTimeout(s,300)},r);return()=>clearTimeout(m)}}else o(!1)},[l,t,r,s]),l?e.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full",children:e.jsx("div",{className:`transform transition-all duration-300 ease-in-out ${n?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"}`,children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 relative",children:[e.jsx("button",{onClick:()=>{o(!1),setTimeout(s,300)},className:"absolute top-2 right-2 text-green-400 hover:text-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-full p-1","aria-label":"Close success notification",children:e.jsx(Ct,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-start gap-3 pr-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Se,{className:"w-5 h-5 text-green-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800 mb-1",children:"Success"}),e.jsx("p",{className:"text-sm text-green-700 leading-relaxed",children:l})]})]}),t&&e.jsx("div",{className:"mt-3 h-1 bg-green-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all duration-300 ease-linear",style:{width:n?"0%":"100%",transitionDuration:`${r}ms`}})})]})})}):null},_e=()=>{const l=V.getCurrentUserId();return l?`structure_analysis_state_${l}`:"structure_analysis_state_anonymous"},os=()=>{const l=V.getCurrentUserId();return l?`comprehensive_history_${l}`:"comprehensive_history_anonymous"},is=()=>{const l=V.getCurrentUserId();return l?`structure_last_saved_${l}`:"structure_last_saved_anonymous"},ut=()=>{const l=V.getCurrentUserId();return l?`structure_last_persisted_${l}`:"structure_last_persisted_anonymous"},gt=l=>{let s=0;if(l.length===0)return s.toString();for(let t=0;t<l.length;t++){const r=l.charCodeAt(t);s=(s<<5)-s+r,s=s&s}return s.toString()};function ys({content:l,url:s}){const[t,r]=f.useState(null),[n,o]=f.useState(!1),[m,k]=f.useState(""),[g,c]=f.useState(!1),[h,S]=f.useState("overview"),[F,E]=f.useState("landing"),[P,J]=f.useState("schema"),[T,U]=f.useState(s||""),[Z,Q]=f.useState(null),[ne,te]=f.useState(!1),[v,L]=f.useState(l||""),[y,b]=f.useState(""),[C,_]=f.useState("landing"),[D,R]=f.useState(""),[w,A]=f.useState(!1),[u,z]=f.useState(!1),[K,B]=f.useState(Date.now()),[M,W]=f.useState(!0),[ee,oe]=f.useState(!1),[Ee,he]=f.useState(!1),[pe,ue]=f.useState(!0),[ge,me]=f.useState(!1);Te(os(),[]);const[x,j]=f.useState(null),[d,G]=f.useState(!1),[q,ie]=f.useState(!1),[se,le]=f.useState(!1),X=(a,i,p)=>{console.log("[Content Analysis] saveToHistory called with:",{hasAnalysisResult:!!a,contentLength:i?.length||0,urlToAnalyze:p,analysisResultKeys:a?Object.keys(a):[]});try{if(!a){console.error("[Content Analysis] No analysis result provided to saveToHistory");return}if(!i){console.error("[Content Analysis] No content provided to saveToHistory");return}console.log("[Content Analysis] Preparing history item with data:",{id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${p?` - ${p}`:""}`,contentLength:i.length,suggestionsCount:a.suggestions?.length||0,hasMetadata:!!a.metadata,hasStructuredContent:!!a.structuredContent});const I=a.suggestions?.filter(N=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(N.type)).map(N=>({type:N.type,priority:N.priority,description:N.description,implementation:N.implementation,impact:N.impact}))||[];console.log("[Content Analysis] Filtered suggestions:",I.length);const O={id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${p?` - ${p}`:""}`,originalContent:i,structuredContent:a.structuredContent||"",analysis:{seoScore:a.seoScore||0,llmOptimizationScore:a.llmOptimizationScore||0,readabilityScore:a.readabilityScore||0,structuredData:a.structuredData,fullPageHtml:a.fullPageHtml,pageTitle:a.pageTitle,pageDescription:a.pageDescription,geoScoreTotal:a.geoScoreTotal||0,geoBreakdown:a.geoBreakdown||{},contentQualityScoreTotal:a.contentQualityScoreTotal||0,contentQualityBreakdown:a.contentQualityBreakdown||{},suggestions:I,metadata:a.metadata||{title:"",description:"",keywords:[],author:"",publishDate:"",lastModified:"",readingTime:0,wordCount:0,language:"en"}}};console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with:",{id:O.id,name:O.name,originalContentLength:O.originalContent.length,structuredContentLength:O.structuredContent.length,analysisKeys:Object.keys(O.analysis)}),console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with data:",O);try{ae.addStructureAnalysisHistory(O),console.log("[Content Analysis] Successfully called historyService.addStructureAnalysisHistory");const N=ae.getHistoryItems();console.log("[Content Analysis] Current history after adding:",{totalItems:N.length,latestItem:N[0]?.name||"None",structureAnalysisItems:N.filter($=>$.type==="structure-analysis").length});const H=N.find($=>$.id===O.id);if(H){console.log("[Content Analysis] ✅ Item successfully added to history:",H.name);try{const $=localStorage.getItem("comprehensive_history"),Y=$?JSON.parse($):[];console.log("[Content Analysis] Direct localStorage check:",{totalStoredItems:Y.length,structureItems:Y.filter(be=>be.type==="structure-analysis").length,ourItemExists:Y.some(be=>be.id===O.id)})}catch($){console.error("[Content Analysis] Error checking localStorage directly:",$)}}else{console.error("[Content Analysis] ❌ Item was NOT added to history!");try{const $=localStorage.getItem("comprehensive_history");if(console.error("[Content Analysis] Debug - localStorage content:",$),$){const Y=JSON.parse($);console.error("[Content Analysis] Debug - parsed localStorage:",Y)}}catch($){console.error("[Content Analysis] Debug - localStorage error:",$)}}}catch(N){console.error("[Content Analysis] Error calling historyService.addStructureAnalysisHistory:",N),N instanceof Error&&console.error("[Content Analysis] Error stack:",N.stack)}}catch(I){console.error("[Content Analysis] Failed to save to history:",I),I instanceof Error&&console.error("[Content Analysis] Error stack:",I.stack)}try{localStorage.setItem(is(),new Date().toISOString())}catch{}};f.useEffect(()=>{const i=Object.keys(localStorage).filter(p=>p.startsWith(_e()));if(i.length>0){let p=i[0],I=0;for(const N of i)try{const H=localStorage.getItem(N);if(H){const $=JSON.parse(H);$.lastAccessed&&$.lastAccessed>I&&(I=$.lastAccessed,p=N)}}catch{}if(I===0)for(const N of i)try{const H=localStorage.getItem(N);if(H&&JSON.parse(H).analysis){p=N;break}}catch{}const O=localStorage.getItem(p);if(O)try{const N=JSON.parse(O);N.urlInput&&U(N.urlInput),N.activeTab&&S(N.activeTab),N.structuredView&&E(N.structuredView),N.schemaView&&J(N.schemaView),N.codeViewType&&_(new Set(["landing","code","improved"]).has(N.codeViewType)?N.codeViewType:"landing"),!v&&N.pastedPreview&&L(N.pastedPreview),N.improvedFullPageHtml&&R(N.improvedFullPageHtml),console.log("[Content Analysis] Restored cached analysis from:",p),setTimeout(()=>{const H={...N,lastAccessed:Date.now()};localStorage.setItem(p,JSON.stringify(H))},100)}catch(N){console.error("[Content Analysis] Error restoring cached state:",N)}}!v&&l&&L(l)},[l]),f.useEffect(()=>{if(t)try{const a={analysis:t,fullPageHtml:y,improvedFullPageHtml:D,activeTab:h,codeViewType:C,urlInput:T,pastedContent:v,savedAt:Date.now()};localStorage.setItem(ut(),JSON.stringify(a)),console.log("[Content Analysis] Analysis persisted for navigation")}catch(a){console.error("[Content Analysis] Error persisting analysis:",a)}},[t,y,D,h,C,T,v]),f.useEffect(()=>()=>{if(t)try{const a={analysis:t,fullPageHtml:y,improvedFullPageHtml:D,activeTab:h,codeViewType:C,urlInput:T,pastedContent:v,savedAt:Date.now()};localStorage.setItem(ut(),JSON.stringify(a)),console.log("[Content Analysis] Analysis persisted on component unmount")}catch(a){console.error("[Content Analysis] Error persisting analysis on unmount:",a)}},[t,y,D,h,C,T,v]),f.useEffect(()=>{if(!t)try{const a=localStorage.getItem("structure_last_persisted");if(a){const i=JSON.parse(a);i.analysis&&i.savedAt&&(Date.now()-i.savedAt<864e5?(console.log("[Content Analysis] Restoring persisted analysis from navigation"),r(i.analysis),i.fullPageHtml&&b(i.fullPageHtml),i.analysis.originalContent&&L(i.analysis.originalContent),i.analysis.crawledUrl&&U(i.analysis.crawledUrl),i.improvedFullPageHtml&&R(i.improvedFullPageHtml),i.activeTab&&S(i.activeTab),i.codeViewType&&_(i.codeViewType),_("landing"),ue(!0),he(!0)):localStorage.removeItem("structure_last_persisted"))}}catch(a){console.error("[Content Analysis] Error restoring persisted analysis:",a),localStorage.removeItem("structure_last_persisted")}},[]);const ce=f.useRef(0);f.useEffect(()=>{const a=()=>{const p=Date.now();p-ce.current<1e3||(ce.current=p,B(p),W(!0))},i=["mousedown","mousemove","keypress","scroll","touchstart","click"];return i.forEach(p=>{document.addEventListener(p,a,!0)}),()=>{i.forEach(p=>{document.removeEventListener(p,a,!0)})}},[]),f.useEffect(()=>{if(v&&v.trim().length>0&&M){const a=gt(v),i=`${_e()}_${a}`,p={urlInput:T,activeTab:h,structuredView:F,schemaView:P,pastedPreview:v.slice(0,1e3),codeViewType:C,lastAccessed:Date.now(),createdAt:Date.now(),isActive:!0};try{localStorage.setItem(i,JSON.stringify(p)),console.log("[Content Analysis] Persisted lightweight state for content hash:",a)}catch{Object.keys(localStorage).forEach(O=>{if(O.startsWith(_e()))try{localStorage.removeItem(O)}catch{}})}}},[T,h,F,P,v,C,M]);const fe=f.useRef(null);f.useEffect(()=>{if(!ee||!v||v.trim().length===0)return;const a=gt(v);if(fe.current===a){oe(!1);return}if(!M){oe(!1);return}console.log("[Content Analysis] User-triggered analysis for content length:",v.length),fe.current=a,Pe(v,T).finally(()=>oe(!1)),ue(!0)},[ee,v,M]);const Pe=async(a,i)=>{if(t&&t.originalContent===a){console.log("[Content Analysis] Using cached analysis for existing content");return}j(null),ue(!0),he(!0),o(!0);try{console.log("[Content Analysis] Starting new analysis for:",i?`URL: ${i}`:`Content length: ${a.length}`);const p=await dt.analyzeContentStructure(a,i);if(console.log("[Content Analysis] Analysis result:",p),console.log("[Content Analysis] Result type:",typeof p),console.log("[Content Analysis] Result keys:",p?Object.keys(p):"No result"),console.log("[Content Analysis] Result structure:",{hasSuggestions:!!p?.suggestions,suggestionsLength:p?.suggestions?.length||0,hasStructuredContent:!!p?.structuredContent,hasMetadata:!!p?.metadata,hasSeoScore:typeof p?.seoScore=="number",hasLlmScore:typeof p?.llmOptimizationScore=="number",hasReadabilityScore:typeof p?.readabilityScore=="number"}),console.log("[Content Analysis] Suggestions:",p?.suggestions),console.log("[Content Analysis] Full page HTML available:",!!p?.fullPageHtml),r(p),p.fullPageHtml)b(p.fullPageHtml),console.log("[Content Analysis] Full page HTML set from analysis response");else if(i)try{const I=await xe.extractFullPageHtml(i);I.success&&(b(I.html),console.log("[Content Analysis] Full page HTML extracted separately"))}catch(I){console.warn("[Content Analysis] Failed to extract full page HTML:",I)}console.log("[Content Analysis] About to save to history with result:",{hasResult:!!p,contentLength:a?.length||0,urlToAnalyze:i,resultKeys:p?Object.keys(p):[]}),console.log("[Content Analysis] Result validation for history:",{hasOriginalContent:!!p?.originalContent,hasStructuredContent:!!p?.structuredContent,hasSeoScore:typeof p?.seoScore=="number",hasLlmScore:typeof p?.llmOptimizationScore=="number",hasReadabilityScore:typeof p?.readabilityScore=="number",hasSuggestions:Array.isArray(p?.suggestions),suggestionsLength:p?.suggestions?.length||0,hasMetadata:!!p?.metadata,hasStructuredData:!!p?.structuredData}),console.log("[Content Analysis] FORCING save to history with FRESH data...");try{const I=new Date,N={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis${i?` - ${i}`:""} - ${I.toLocaleTimeString()}`,originalContent:a,structuredContent:p.structuredContent||a,analysis:{suggestions:(p.suggestions||[]).filter(Y=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(Y.type)).map(Y=>({type:Y.type,priority:Y.priority,description:Y.description||"",implementation:Y.implementation||"",impact:Y.impact||""})),metadata:{title:p.metadata?.title||"Analyzed Content",description:p.metadata?.description||"Content structure analysis",keywords:p.metadata?.keywords||[],author:p.metadata?.author||"Unknown",publishDate:I.toISOString().split("T")[0],lastModified:I.toISOString().split("T")[0],readingTime:Math.ceil(a.length/1e3),wordCount:a.split(/\s+/).length,language:"en"},structuredData:p.structuredData||{},fullPageHtml:p.fullPageHtml||"",pageTitle:p.pageTitle||"",pageDescription:p.pageDescription||"",geoScoreTotal:p.geoScoreTotal,geoBreakdown:p.geoBreakdown,contentQualityScoreTotal:p.contentQualityScoreTotal,contentQualityBreakdown:p.contentQualityBreakdown,wordCount:p.metadata?.wordCount||a.split(/\s+/).length,readingTime:p.metadata?.readingTime||Math.ceil(a.length/1e3),suggestionsCount:(p.suggestions||[]).length,language:p.metadata?.language||"en"}};console.log("[Content Analysis] FRESH history item created:",{id:N.id,name:N.name,timestamp:I.toISOString(),contentLength:N.originalContent.length}),ae.addStructureAnalysisHistory(N);const H=ae.getHistoryItems(),$=H.find(Y=>Y.id===N.id);$?(console.log("[Content Analysis] ✅ SUCCESSFULLY saved FRESH item to history!",$.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(H)})),window.location.pathname==="/history"&&(console.log("[Content Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[Content Analysis] ❌ FAILED to save FRESH item to history!")}catch(I){console.error("[Content Analysis] Direct save error:",I)}X(p,a,i);try{await xe.saveLastStructureAnalysis({...p,crawledUrl:i||T||""})}catch{}try{const I=i||T;if(I){let O="/";try{const N=new URL(I);O=N.pathname+(N.search||"")}catch{}}}catch{}}catch(p){console.error("Error analyzing content:",p),alert("Failed to analyze content structure")}finally{o(!1)}},Ie=async()=>{if(!T.trim()){Q("Please enter a URL to analyze.");return}try{new URL(T)}catch{Q("Please enter a valid URL (e.g., https://example.com)");return}te(!0),Q(null);try{const a=await dt.analyzeContentStructure("",T);if(console.log("[URL Analysis] Raw result:",a),a){const i={...a,geoScoreTotal:a.geoScoreTotal||a.seoScore||0,geoBreakdown:a.geoBreakdown||{},contentQualityScoreTotal:a.contentQualityScoreTotal||a.readabilityScore||0,contentQualityBreakdown:a.contentQualityBreakdown||{},metadata:a.metadata?{...a.metadata,title:a.metadata.title||a.pageTitle||"No Title",description:a.metadata.description||a.pageDescription||"No Description",keywords:a.metadata.keywords||[],author:a.metadata.author||"Unknown",publishDate:a.metadata.publishDate||"Unknown",lastModified:a.metadata.lastModified||"Unknown",readingTime:a.metadata.readingTime||1,wordCount:a.metadata.wordCount||0,language:a.metadata.language||"en",contentStructure:a.metadata.contentStructure||{headings:[],paragraphs:[],lists:[]}}:{title:a.pageTitle||"No Title",description:a.pageDescription||"No Description",keywords:[],author:"Unknown",publishDate:"Unknown",lastModified:"Unknown",readingTime:1,wordCount:0,language:"en",contentStructure:{headings:[],paragraphs:[],lists:[]}},suggestions:a.suggestions||[],structuredData:a.structuredData||{},fullPageHtml:a.fullPageHtml||"",pageTitle:a.pageTitle||"",pageDescription:a.pageDescription||"",originalContent:a.originalContent||"",structuredContent:a.structuredContent||a.fullPageHtml||""};console.log("[URL Analysis] Safe result:",i),console.log("[URL Analysis] Metadata debug:",{hasMetadata:!!a.metadata,metadataKeys:a.metadata?Object.keys(a.metadata):[],publishDate:a.metadata?.publishDate,publishDateType:typeof a.metadata?.publishDate,publishDateLength:a.metadata?.publishDate?.length,publishDateIsNull:a.metadata?.publishDate===null,publishDateIsUndefined:a.metadata?.publishDate===void 0,publishDateIsToday:a.metadata?.publishDate===new Date().toISOString().split("T")[0]}),r(i),b(i.fullPageHtml||""),L(i.originalContent||""),_("landing"),ue(!0),he(!0),console.log("[URL Analysis] Saving to history...");try{const p=new Date,O={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis - ${T} - ${p.toLocaleTimeString()}`,originalContent:i.originalContent||"",structuredContent:i.structuredContent||i.fullPageHtml||"",analysis:{suggestions:(i.suggestions||[]).filter($=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes($.type)).map($=>({type:$.type,priority:$.priority,description:$.description||"",implementation:$.implementation||"",impact:$.impact||""})),metadata:{title:i.metadata?.title||"Analyzed Content",description:i.metadata?.description||"Content structure analysis",keywords:i.metadata?.keywords||[],author:i.metadata?.author||"Unknown",publishDate:i.metadata?.publishDate||p.toISOString().split("T")[0],lastModified:i.metadata?.lastModified||p.toISOString().split("T")[0],readingTime:i.metadata?.readingTime||Math.ceil((i.originalContent||"").length/1e3),wordCount:i.metadata?.wordCount||(i.originalContent||"").split(/\s+/).length,language:i.metadata?.language||"en"},structuredData:i.structuredData||{},fullPageHtml:i.fullPageHtml||"",pageTitle:i.pageTitle||"",pageDescription:i.pageDescription||"",geoScoreTotal:i.geoScoreTotal,geoBreakdown:i.geoBreakdown,contentQualityScoreTotal:i.contentQualityScoreTotal,contentQualityBreakdown:i.contentQualityBreakdown,wordCount:i.metadata?.wordCount||(i.originalContent||"").split(/\s+/).length,readingTime:i.metadata?.readingTime||Math.ceil((i.originalContent||"").length/1e3),suggestionsCount:(i.suggestions||[]).length,language:i.metadata?.language||"en"}};console.log("[URL Analysis] FRESH history item created:",{id:O.id,name:O.name,timestamp:p.toISOString(),contentLength:O.originalContent.length}),ae.addStructureAnalysisHistory(O);const N=ae.getHistoryItems(),H=N.find($=>$.id===O.id);H?(console.log("[URL Analysis] ✅ SUCCESSFULLY saved URL analysis to history!",H.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(N)})),window.location.pathname==="/history"&&(console.log("[URL Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[URL Analysis] ❌ FAILED to save URL analysis to history!")}catch(p){console.error("[URL Analysis] Error saving to history:",p)}}else Q("Failed to analyze URL. Please try again.")}catch(a){console.error("URL analysis error:",a),Q(a.message||"Failed to analyze URL. Please try again.")}finally{te(!1)}},Fe=async()=>{if(t){c(!0);try{let a;const i=t.fullPageHtml||y||l;if(!i){alert("No content available to improve.");return}try{if(a=Ce(i,t.suggestions),!a||a.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(a,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors")}catch(p){console.error("Error in applySuggestionsWithDOM:",p),alert("Failed to apply suggestions due to HTML processing error. Please try again.");return}t.fullPageHtml||y?(R(a),z(!0),_("improved")):k(a),j(`✅ Applied ${t.suggestions.length} suggestions successfully!`)}catch(a){console.error("Error applying suggestions:",a),alert("Failed to apply structure suggestions")}finally{c(!1)}}},Re=a=>{navigator.clipboard.writeText(a),alert("Copied to clipboard!")},je=a=>{const i=window.open("","_blank");i?(i.document.write(a),i.document.close()):alert("Please allow popups to run the code in a new window.")},Me=()=>{D?je(D):t?.fullPageHtml?je(t.fullPageHtml):alert("No page content available to run. Please analyze a URL first.")},$e=()=>{if(!t?.fullPageHtml){alert("No original page content available.");return}const a=t.fullPageHtml;let i=D&&D.trim().length>0?D:"";if(!i||i.replace(/\s+/g,"")===a.replace(/\s+/g,""))try{const O=Ce(a,t.suggestions,{highlight:!0});i=O||a,R(O)}catch{i=a}const p=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Comparison - Original vs Improved</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .comparison-container { display: flex; gap: 20px; height: 100vh; }
        .page-frame { flex: 1; border: 2px solid #ddd; border-radius: 8px; }
        .page-frame h3 { margin: 0; padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; }
        .page-frame.original h3 { background: #ffebee; color: #c62828; }
        .page-frame.improved h3 { background: #e8f5e8; color: #2e7d32; }
        iframe { width: 100%; height: calc(100% - 50px); border: none; }
    </style>
</head>
<body>
    <div class="comparison-container">
        <div class="page-frame original">
            <h3>🔴 Original Page</h3>
            <iframe srcdoc="${a.replace(/"/g,"&quot;")}"></iframe>
        </div>
        <div class="page-frame improved">
            <h3>🟢 Improved Page</h3>
            <iframe srcdoc="${i.replace(/"/g,"&quot;")}"></iframe>
        </div>
    </div>
</body>
</html>`,I=window.open("","_blank");I?(I.document.write(p),I.document.close()):alert("Please allow popups to view the comparison.")},Ne=async()=>{if(t)try{j("🔄 Applying suggestions and generating improved code...");const a=t.fullPageHtml||y;if(!a){j("❌ No HTML content available to improve.");return}console.log("[Content Analysis] Applying suggestions to HTML:",{sourceHtmlLength:a.length,suggestionsCount:t.suggestions.length,suggestions:t.suggestions.map(H=>({type:H.type,hasExactReplacement:!!H.exactReplacement}))});const i=Ce(a,t.suggestions);console.log("[Content Analysis] Improved code generated:",{improvedCodeLength:i.length,hasChanges:i!==a}),R(i),z(!0),await navigator.clipboard.writeText(i);const p=t.suggestions.length,I=t.suggestions.map(H=>H.type).slice(0,3),O=I.length>0?` (${I.join(", ")}${I.length<p?"...":""})`:"";j(`✅ ${p} suggestions applied${O}! Improved code copied to clipboard.`),window.confirm("Improved code copied to clipboard! Would you like to run the improved page in a new window?")&&je(i)}catch(a){console.error("Error copying and running code:",a),j("❌ Failed to apply suggestions. Please try again."),setTimeout(()=>j(null),3e3)}},Ue=async a=>{if(t)try{j(`🔄 Applying ${a.type} suggestion...`);const i=t.fullPageHtml||y;if(!i){j("❌ No HTML content available to improve.");return}console.log("[Content Analysis] Applying single suggestion:",{type:a.type,hasExactReplacement:!!a.exactReplacement,currentContent:a.currentContent?.substring(0,100)+"...",enhancedContent:a.enhancedContent?.substring(0,100)+"..."});let p;try{if(p=Ce(i,[a]),!p||p.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(p,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors")}catch(I){if(console.error("Error in applySuggestionsWithDOM:",I),a.exactReplacement)try{const{find:O,replace:N}=a.exactReplacement;if(i.includes(O))p=i.replace(O,N),console.log("[Content Analysis] Applied fallback exact replacement");else throw new Error("Exact replacement pattern not found")}catch(O){console.error("Fallback also failed:",O),j("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>j(null),3e3);return}else{j("❌ Failed to apply suggestion due to HTML processing error. Please try again."),setTimeout(()=>j(null),3e3);return}}R(p),z(!0),j(`✅ ${a.type} suggestion applied! Check the "Improved" tab to see changes.`),_("improved")}catch(i){console.error("Error applying single suggestion:",i),j("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>j(null),3e3)}},De=(a,i)=>{const p=new Blob([a],{type:"text/plain"}),I=URL.createObjectURL(p),O=document.createElement("a");O.href=I,O.download=i,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(I)},ve=a=>a>=80?"text-green-600":a>=60?"text-yellow-600":"text-red-600",Le=a=>a>=80?"bg-green-100":a>=60?"bg-yellow-100":"bg-red-100",He=a=>{switch(a){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},qe=a=>{switch(a){case"high":return e.jsx(Dt,{className:"w-4 h-4"});case"medium":return e.jsx(rt,{className:"w-4 h-4"});case"low":return e.jsx(Se,{className:"w-4 h-4"});default:return e.jsx(rt,{className:"w-4 h-4"})}},Be=({html:a})=>{const i=St.useMemo(()=>`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin: 0; padding: 0; background: transparent; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .__wrap { max-width: 1024px; margin: 0 auto; padding: 16px; box-sizing: border-box; }
    img, video, iframe { max-width: 100%; height: auto; }
    h1, h2, h3, h4, h5, h6 { margin-top: 1.2em; margin-bottom: .5em; }
    p { line-height: 1.6; }
  </style>
  </head>
<body>
  <div class="__wrap">${a||""}</div>
</body>
</html>`,[a]);return e.jsx("iframe",{title:"Landing Preview",sandbox:"allow-same-origin",srcDoc:i,loading:"lazy",style:{width:"100%",height:"75vh",border:"none",borderRadius:"0.5rem",background:"transparent"}})},Ve=(a,i)=>{if(!Array.isArray(a)||!i)return a||[];const p=i.toLowerCase(),I=new Map,O=new Set,N=["artificial intelligence","ai","machine learning","ml","deep learning","data science","analytics","insights","metrics","performance","cloud computing","saas","platform","integration","api","business intelligence","reporting","dashboard","visualization","digital transformation","innovation","technology","solution","user experience","ux","interface","design","usability","security","compliance","governance","risk","audit","scalability","reliability","availability","backup","recovery","migration","tenant","onedrive","sharepoint","teams","cloudfuze","microsoft 365","google workspace","metadata"];return a.forEach(H=>{const $=(H||"").trim();if(!$)return;const Y=$.toLowerCase();if(O.has(Y))return;const be=Y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`(^|[^a-z0-9])${be}([^a-z0-9]|$)`,"i").test(p)){O.add(Y);let Ae=0;N.some(bt=>Y.includes(bt))&&(Ae+=5),Y.split(" ").length>=2&&(Ae+=3),Y.length>8&&(Ae+=2),(Y.includes("-")||/[A-Z]/.test($))&&(Ae+=2);const wt=(p.match(new RegExp(be,"gi"))||[]).length;I.set($,wt+Ae)}}),Array.from(I.entries()).sort((H,$)=>$[1]!==H[1]?$[1]-H[1]:$[0].length-H[0].length).map(([H])=>H).slice(0,25)},we=a=>{const i=a.currentContent||a?.exactReplacement?.find||"",p=a.enhancedContent||a?.exactReplacement?.replace||a.implementation||"";return{current:i,enhanced:p}};if(f.useEffect(()=>{if(C==="improved"&&y&&t&&t.suggestions.length>0){A(!0);try{const a=Ce(y,t.suggestions,{highlight:!0});R(a)}catch{R("Failed to generate improved code.")}finally{A(!1)}}},[C,y,t]),n&&!t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-black mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-black mb-2",children:"Analyzing Content Structure"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing your content for SEO and LLM optimization..."}),Z&&e.jsx("div",{className:"mt-6 inline-block bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded",children:Z})]})})});const ze=()=>{r(null),U(""),Q(null),L(""),k(""),b(""),_("landing"),R(""),j(null),W(!0),ue(!1),he(!1),Object.keys(localStorage).forEach(i=>{i.startsWith(_e())&&localStorage.removeItem(i)}),localStorage.removeItem("structure_last_persisted"),console.log("[Content Analysis] New analysis initiated - state cleared")};return t?e.jsxs(e.Fragment,{children:[e.jsx(ns,{message:x,onClose:()=>j(null),autoClose:!0,autoCloseDelay:4e3}),e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(Oe,{className:"w-8 h-8 text-black flex-shrink-0"}),e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-black truncate",children:"Content Structure Analysis"})]}),e.jsxs("div",{className:"flex gap-2 lg:gap-3 flex-shrink-0 items-center",children:[e.jsx("button",{onClick:ze,className:"bg-blue-600 text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold text-sm lg:text-base",children:"New Analysis"}),e.jsxs("button",{onClick:()=>De(t.structuredContent,"improved-content.txt"),className:"bg-blue-600 text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm lg:text-base",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[t?.geoScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Le(t.geoScoreTotal)}`,children:e.jsx(Oe,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"GEO Score Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"AI visibility and search engine optimization breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>le(a=>!a),children:se?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${ve(t.geoScoreTotal)}`,children:[t.geoScoreTotal,"/100"]})]}),t?.contentQualityScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Le(t.contentQualityScoreTotal)}`,children:e.jsx(Tt,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"Content Quality Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Human/editorial score breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>ie(a=>!a),children:q?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${ve(t.contentQualityScoreTotal)}`,children:[t.contentQualityScoreTotal,"/100"]})]})]}),t?.geoBreakdown&&se&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"GEO Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(t.geoBreakdown).map(([a,i])=>{const I={evidence_attribution:30,answerability_snippetability:25,structured_understanding:20,freshness_stability:10,entity_topic_coverage:10,retrieval_friendliness:5}[a]??5,O=i.score?.toFixed?`${i.score.toFixed(1)}/${I}`:`${i.score}/${I}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:a.replace(/_/g," ").replace(/\b\w/g,N=>N.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:O})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(i).filter(([N])=>N!=="score").map(([N,H])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:N.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof H=="number"?H.toFixed(1):String(H)})]},N))})]},a)})})]}),t?.contentQualityBreakdown&&q&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"Content Quality Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(t.contentQualityBreakdown).map(([a,i])=>{const I={readability_clarity:20,structure_coherence:15,depth_coverage:20,originality:15,accuracy_source_use:10,style_tone:10,accessibility_presentation:10}[a]??20,O=i.score?.toFixed?`${i.score.toFixed(1)}/${I}`:`${i.score}/${I}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:a.replace(/_/g," ").replace(/\b\w/g,N=>N.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:O})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(i).filter(([N])=>N!=="score").map(([N,H])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:N.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof H=="number"?H.toFixed(1):String(H)})]},N))})]},a)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 mb-8 w-full overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex flex-wrap gap-2 lg:gap-0 lg:space-x-8 px-4 lg:px-6 py-2 lg:py-0",children:[{id:"overview",label:"Overview",icon:Qe},{id:"suggestions",label:"Suggestions",icon:Ke},{id:"structured",label:"Structured Content",icon:Et},{id:"schema",label:"Schema Markup",icon:It}].map(a=>e.jsxs("button",{onClick:()=>S(a.id),className:`flex items-center gap-1 lg:gap-2 py-2 lg:py-4 px-2 lg:px-4 rounded-lg font-bold text-xs lg:text-sm transition-colors whitespace-nowrap 
                    ${h===a.id?"bg-white text-black":"bg-black text-white opacity-80 hover:opacity-100"}
                  `,children:[e.jsx(a.icon,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:a.label}),e.jsx("span",{className:"sm:hidden",children:a.label.split(" ")[0]})]},a.id))})}),e.jsxs("div",{className:"p-4 lg:p-6 w-full overflow-hidden",children:[h==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Summary"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.metadata?.wordCount||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Words"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.metadata?.readingTime||1}),e.jsx("div",{className:"text-sm text-gray-600",children:"Min Read"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.suggestions?.length||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Suggestions"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:(t?.metadata?.language||"en").toUpperCase()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Language"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Metadata"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:t?.metadata?.title||"No Title",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:t?.metadata?.description||"No Description",readOnly:!0,rows:3,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ve(t?.metadata?.keywords||[],t?.originalContent||"").map((a,i)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:a},i))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Author"}),e.jsx("input",{type:"text",value:t?.metadata?.author||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Publish Date"}),e.jsx("input",{type:"text",value:t?.metadata?.publishDate||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reading Time"}),e.jsx("input",{type:"text",value:`${t?.metadata?.readingTime||1} minutes`,readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]})]})]})]})]}),h==="suggestions"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-6 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Structure Improvement Suggestions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Me,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),"Run Full Page"]}),e.jsxs("button",{onClick:$e,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Compare Pages"]}),e.jsxs("button",{onClick:Fe,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Apply All Suggestions"]})]})]}),e.jsx("div",{className:"space-y-6",children:t?.suggestions?.map((a,i)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${He(a.priority)}`,children:qe(a.priority)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h4",{className:"font-semibold text-black text-lg",children:a.description}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${He(a.priority)}`,children:a.priority})]}),(()=>{const{current:p}=we(a);return p})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Current Content:"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-red-700 font-mono whitespace-pre-wrap",children:we(a).current})})]}),(()=>{const{enhanced:p}=we(a);return p})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Enhanced Content:"}),e.jsx("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-green-800 font-mono whitespace-pre-wrap",children:we(a).enhanced})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"🎯 Impact:"})," ",a.impact]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>Ue(a),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Apply This Suggestion"]})})]})]})},i))})]}),h==="structured"&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Improved Content Structure"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${C==="landing"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>_("landing"),children:"Landing"}),e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${C==="code"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>_("code"),children:"Code"}),C==="code"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Re(y),className:"bg-gray-100 text-black px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(Ft,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Code"})]}),e.jsxs("button",{onClick:Ne,className:"bg-black text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-800 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(st,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy & Run"})]}),e.jsxs("button",{onClick:()=>De(y,"original-page.html"),className:"bg-gray-600 text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(tt,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]})]}),C==="landing"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-2 w-full",children:e.jsx(Be,{html:t.structuredContent})}):C==="improved"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:D||'No improved code available yet. Click "Copy & Run" to generate improved code.'})})}):e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:y||"No code extracted yet."})})})]}),h==="schema"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:e.jsx("h3",{className:"text-lg font-semibold text-black mb-0",children:"Structured Data Markup"})}),e.jsxs("div",{className:"space-y-6",children:[t?.structuredData?.articleSchema&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-black mb-2",children:"Article Schema"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:e.jsx("pre",{className:"text-xs lg:text-sm text-black font-mono break-words whitespace-pre-wrap",children:JSON.stringify(t.structuredData.articleSchema,null,2)})})]}),t?.structuredData?.faqSchema&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-black mb-2",children:"FAQ Schema"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:e.jsx("pre",{className:"text-xs lg:text-sm text-black font-mono break-words whitespace-pre-wrap",children:JSON.stringify(t.structuredData.faqSchema,null,2)})})]}),!t?.structuredData?.articleSchema&&!t?.structuredData?.faqSchema&&e.jsx("div",{className:"text-sm text-gray-600",children:"No structured data captured for the last analysis."})]})]})]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-black mb-2",children:"Content Structure Analysis"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Analyze your content for SEO and LLM optimization"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-black mb-4",children:"New Analysis"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Enter a URL to analyze its content structure"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"url",value:T,onChange:a=>We(a,i=>{U(i),B(Date.now()),W(!0)}),onPaste:a=>Ye(a,i=>{U(i),B(Date.now()),W(!0)}),onKeyDown:Xe,onFocus:()=>{B(Date.now()),W(!0)},required:!0,placeholder:"Paste a URL to analyze...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-base",disabled:ne}),e.jsx("button",{onClick:Ie,disabled:ne||!T.trim(),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold disabled:opacity-50",children:ne?"Analyzing...":"Analyze URL"})]}),Z&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm",children:Z})]})}),e.jsx("div",{children:e.jsx("div",{className:"bg-white rounded-xl p-8 border border-gray-200 h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-gray-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-black mb-3",children:"Ready to Analyze"}),e.jsx("p",{className:"text-gray-600 mb-6 text-lg",children:"Enter a URL in the left panel to start your content structure analysis"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 text-left",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-black mb-2",children:"What You'll Get"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• SEO optimization insights"}),e.jsx("li",{children:"• Content structure analysis"}),e.jsx("li",{children:"• LLM-friendly improvements"}),e.jsx("li",{children:"• Actionable recommendations"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-black mb-2",children:"Analysis Features"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Content quality scoring"}),e.jsx("li",{children:"• GEO score breakdown"}),e.jsx("li",{children:"• Structure suggestions"}),e.jsx("li",{children:"• Code generation"})]})]})]})]})})})]})]})})}export{ms as A,ys as C,hs as O,ns as S,V as a,Ye as b,We as c,Xe as d,xe as e,vt as f,Te as g,ae as h,ps as i,e as j,gs as k,xt as u};
